<html lang="tr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>HidroQuiz - Oyunla≈ütƒ±rma</title>
  <style>
    :root {
      --bg: #241B3A;
      --bg2: #2B2047;
      --surface: #2F2450;
      --surface2: #3A2B66;
      --primary: #7C5CFF;
      --success: #38D9A9;
      --danger: #FF6B6B;
      --warn: #FFD43B;
      --text: #FFFFFF;
      --text2: #CFC7E8;
      --stroke: rgba(255, 255, 255, .10);
      --shadow: 0 10px 30px rgba(0, 0, 0, .28);
      --r16: 16px;
      --r24: 24px;
      --r32: 32px;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .choice.ok-answer {
      border-color: var(--success) !important;
      background: rgba(56, 217, 169, 0.15) !important;
      color: var(--success);
    }

    .choice.bad-answer {
      border-color: var(--danger) !important;
      background: rgba(255, 107, 107, 0.15) !important;
      color: var(--danger);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    button {
      font-family: inherit;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    .grid {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 1024px) {
      .grid {
        grid-template-columns: 240px 1fr 300px;
        align-items: start;
      }
    }

    .card {
      background: rgba(47, 36, 80, .75);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      border-radius: var(--r24);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .card.pad {
      padding: 16px;
    }

    .muted {
      color: var(--text2);
    }

    .title {
      font-size: 28px;
      font-weight: 900;
      letter-spacing: .2px;
      margin: 0;
    }

    .h2 {
      font-size: 18px;
      font-weight: 800;
      margin: 0;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .pill {
      display: flex;
      align-items: center;
      gap: 8px;
      height: 36px;
      padding: 0 12px;
      background: rgba(58, 43, 102, .70);
      border: 1px solid var(--stroke);
      border-radius: 999px;
      font-weight: 800;
      user-select: none;
    }

    .btn {
      height: 52px;
      border-radius: 18px;
      border: 1px solid transparent;
      background: var(--primary);
      color: white;
      font-weight: 900;
      letter-spacing: .2px;
      padding: 0 16px;
      box-shadow: var(--shadow);
      cursor: pointer;
    }

    .btn:active {
      transform: translateY(1px);
      opacity: .95;
    }

    .btn.secondary {
      background: rgba(255, 255, 255, .06);
      border-color: var(--stroke);
    }

    .btn.ghost {
      background: transparent;
      border-color: var(--stroke);
    }

    .btn:disabled {
      opacity: .5;
      cursor: not-allowed;
    }

    .small {
      font-size: 12px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid var(--stroke);
      font-weight: 800;
      font-size: 12px;
      user-select: none;
    }

    .hero {
      background: linear-gradient(180deg, rgba(36, 27, 58, .2) 0%, rgba(43, 32, 71, .85) 100%);
      border: 1px solid var(--stroke);
      border-radius: var(--r32);
      padding: 18px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    /* .hero:before removed as per request */

    /* Mascot Styles */
    .mascot-container {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .mascot-img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
    }

    .mascot-img.large {
      width: 64px;
      height: 64px;
    }

    .mascot-bubble {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 12px 16px;
      position: relative;
      flex: 1;
    }

    .mascot-bubble::before {
      content: '';
      position: absolute;
      left: -8px;
      top: 16px;
      width: 0;
      height: 0;
      border-top: 8px solid transparent;
      border-bottom: 8px solid transparent;
      border-right: 8px solid rgba(255, 255, 255, 0.08);
    }

    .mascot-text {
      font-weight: 600;
      font-size: 14px;
      line-height: 1.4;
    }

    .notice.with-mascot {
      padding: 16px;
    }

    .notice.with-mascot .mascot-container {
      align-items: center;
    }

    .notice.with-mascot .mascot-text {
      font-size: 15px;
    }

    .progress {
      height: 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .12);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .bar {
      height: 100%;
      width: 55%;
      background: var(--success);
      border-radius: 999px;
    }

    .navdesk .item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid transparent;
      font-weight: 900;
      cursor: pointer;
      user-select: none;
    }

    .navdesk .item:hover {
      background: rgba(255, 255, 255, .05);
    }

    .navdesk .item.active {
      background: rgba(124, 92, 255, .18);
      border-color: rgba(124, 92, 255, .55);
    }

    .navdesk .logo {
      font-weight: 1000;
      font-size: 18px;
      letter-spacing: .3px;
    }

    .navdesk .sub {
      margin-top: 4px;
    }

    .phone {
      max-width: 720px;
      margin: 0 auto;
      padding-bottom: 92px;
      /* mobile nav space */
    }

    @media (min-width: 1024px) {
      .phone {
        max-width: unset;
        padding-bottom: 0;
      }
    }

    .bottomNav {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 0;
      width: min(720px, calc(100% - 24px));
      padding: 12px 0 14px;
      z-index: 20;
    }

    @media (min-width: 1024px) {
      .bottomNav {
        display: none;
      }
    }

    .bottomNav .bar {
      display: flex;
      justify-content: space-between;
      background: rgba(47, 36, 80, .78);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 10px 8px;
    }

    .bottomNav button {
      width: 20%;
      background: transparent;
      border: 0;
      color: var(--text2);
      padding: 8px 6px;
      border-radius: 14px;
      cursor: pointer;
      font-weight: 900;
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: center;
    }

    .bottomNav button.active {
      color: var(--primary);
      background: rgba(124, 92, 255, .12);
    }

    .icon {
      font-size: 18px;
      line-height: 1;
    }

    /* Content sections */
    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* Tiles */
    .tiles {
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr;
    }

    @media (min-width: 640px) {
      .tiles {
        grid-template-columns: 1fr 1fr;
      }
    }

    .tile {
      padding: 16px;
      border-radius: var(--r24);
      background: rgba(47, 36, 80, .72);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: transform .12s ease, background .12s ease;
    }

    .tile:hover {
      background: rgba(255, 255, 255, .06);
      transform: translateY(-1px);
    }

    .tile .t {
      font-weight: 1000;
      font-size: 20px;
    }

    .tile .d {
      margin-top: 6px;
      color: var(--text2);
    }

    /* List items */
    .list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid var(--stroke);
    }

    /* Quiz */
    .quizBox .formula {
      text-align: center;
      font-size: 24px;
      letter-spacing: .8px;
      padding: 14px 12px;
      border-radius: 18px;
      background: rgba(0, 0, 0, .18);
      border: 1px solid var(--stroke);
      margin: 12px 0;
    }

    .choices {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .choice {
      padding: 14px;
      border-radius: 18px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid var(--stroke);
      color: white;
      font-weight: 900;
      cursor: pointer;
      text-align: left;
    }

    .choice.selected {
      background: rgba(124, 92, 255, .18);
      border-color: rgba(124, 92, 255, .55);
    }

    /* Grid choices for visual options */
    .choices.grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .choices.grid .choice {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px;
    }

    /* True/False specific style */
    .choices.tf {
      flex-direction: row;
    }

    .choices.tf .choice {
      flex: 1;
      text-align: center;
      font-size: 18px;
    }

    .notice {
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255, 255, 255, .05);
      font-weight: 900;
    }

    .notice.ok {
      border-color: rgba(56, 217, 169, .7);
      background: rgba(56, 217, 169, .12);
    }

    .notice.bad {
      border-color: rgba(255, 107, 107, .7);
      background: rgba(255, 107, 107, .12);
    }

    /* Numbering Game */
    .gameWrap {
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr;
    }

    @media (min-width: 900px) {
      .gameWrap {
        grid-template-columns: 1fr 300px;
        align-items: start;
      }
    }

    .stage {
      background: rgba(47, 36, 80, .55);
      border: 1px solid var(--stroke);
      border-radius: var(--r24);
      box-shadow: var(--shadow);
      padding: 12px;
      overflow: hidden;
    }

    svg {
      max-width: 100%;
      height: auto;
      display: block;
    }

    .tokenRow {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .token {
      min-width: 48px;
      height: 44px;
      padding: 0 14px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(58, 43, 102, .8);
      font-weight: 1000;
      cursor: grab;
      user-select: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .token:active {
      cursor: grabbing;
      transform: translateY(1px);
    }

    .token.selected {
      outline: 3px solid rgba(124, 92, 255, .55);
      background: rgba(124, 92, 255, .22);
    }

    .hint {
      font-size: 12px;
      color: var(--text2);
      line-height: 1.35;
    }

    .kbd {
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid var(--stroke);
      background: rgba(255, 255, 255, .06);
      font-weight: 1000;
      font-size: 11px;
    }

    /* Node slots in svg */
    .slot {
      cursor: pointer;
      transition: transform .08s ease;
    }

    .slot:hover {
      transform: scale(1.03);
    }

    .slotFill {
      font-weight: 1000;
      fill: white;
      paint-order: stroke;
      stroke: rgba(0, 0, 0, .35);
      stroke-width: 4px;
    }

    .slotRing {
      fill: rgba(255, 255, 255, .06);
      stroke: rgba(255, 255, 255, .18);
      stroke-width: 2px;
    }

    .slotRing.ok {
      stroke: rgba(56, 217, 169, .85);
      fill: rgba(56, 217, 169, .12);
    }

    .slotRing.bad {
      stroke: rgba(255, 107, 107, .85);
      fill: rgba(255, 107, 107, .12);
    }

    /* Interactive Atom Selection */
    .atom {
      cursor: pointer;
      transition: all 0.15s ease;
      fill: var(--surface2);
      stroke: var(--stroke);
      stroke-width: 2px;
    }

    .atom:hover {
      fill: rgba(255, 255, 255, 0.2);
    }

    .atom.selected {
      fill: var(--primary);
      stroke: rgba(124, 92, 255, 0.8);
      stroke-width: 3px;
      filter: drop-shadow(0 0 4px var(--primary));
    }

    .atom.correct {
      fill: var(--success);
      stroke: rgba(56, 217, 169, 0.8);
      filter: drop-shadow(0 0 6px var(--success));
    }

    .atom.wrong {
      fill: var(--danger);
      stroke: rgba(255, 107, 107, 0.8);
    }

    /* Interactive Bond */
    .bond {
      stroke: rgba(255, 255, 255, 0.2);
      stroke-width: 4px;
      stroke-linecap: round;
    }

    /* Right panel (desktop) */
    .sticky {
      position: sticky;
      top: 16px;
    }

    .rp .league .li {
      font-weight: 900;
    }

    /* Step badges */
    .step-badge {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), #9B7CFF);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 1000;
      font-size: 18px;
      color: white;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(124, 92, 255, 0.4);
    }

    .step-item {
      margin-bottom: 8px;
    }

    .step-item.locked {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .step-item.completed .step-badge {
      background: linear-gradient(135deg, var(--success), #5CE5BE);
    }

    .step-item.completed .tag {
      background: rgba(56, 217, 169, 0.15);
      border-color: rgba(56, 217, 169, 0.5);
      color: var(--success);
    }

    /* Badges */
    .badges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .badge-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 6px;
      padding: 12px 8px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      border: 1px solid var(--stroke);
      transition: all 0.2s ease;
    }

    .badge-item.unlocked {
      background: rgba(124, 92, 255, 0.15);
      border-color: rgba(124, 92, 255, 0.6);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .badge-item.locked {
      opacity: 0.5;
      filter: grayscale(1);
    }

    .badge-icon {
      font-size: 28px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    .badge-title {
      font-weight: 800;
      font-size: 11px;
      line-height: 1.2;
    }

    .badge-desc {
      font-size: 10px;
      color: var(--text2);
      display: none;
    }

    .badge-item:hover .badge-desc {
      display: block;
      position: absolute;
      background: #111;
      padding: 4px 8px;
      border-radius: 4px;
      z-index: 10;
      transform: translateY(40px);
    }
  </style>
  <style id="antigravity-scroll-lock-style">
    html:root body.antigravity-scroll-lock {
      overflow: hidden !important;
    }
  </style>
</head>

<body class="">
  <div class="wrap">
    <div class="grid">
      <!-- LEFT SIDEBAR (desktop) -->
      <aside class="navdesk card pad" style="display: none;" id="deskSidebar">
        <div class="logo">HidroQuiz</div>
        <div class="sub muted small">Hidrokarbon adlandƒ±rma</div>
        <div style="height:12px"></div>
        <div id="deskNav">
          <div class="item"><span class="icon">üè†</span><span>Ana Sayfa</span></div>
          <div class="item"><span class="icon">üìö</span><span>√ñƒüren</span></div>
          <div class="item"><span class="icon">‚öîÔ∏è</span><span>M√ºcadele</span></div>
          <div class="item"><span class="icon">üõí</span><span>D√ºkkan</span></div>
          <div class="item"><span class="icon">üë§</span><span>Profil</span></div>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="phone">
        <!-- HERO / TOP STATUS (mobile visible, desktop main also) -->
        <div class="hero">
          <div class="row">
            <div>
              <div class="tag"><span class="icon">‚öõÔ∏è</span> 12. Sƒ±nƒ±f Kimya</div>
            </div>
            <div class="row">
              <div class="pill" title="Can"><span>‚ù§Ô∏è</span><span id="heartsVal">3</span></div>
              <div class="pill" title="Jeton"><span>ü™ô</span><span id="coinsVal">125</span></div>
            </div>
          </div>

          <div style="height:12px"></div>
          <h1 class="title">Hidrokarbonlar</h1>
          <div class="muted" style="margin-top:6px;">Adlandƒ±rmayƒ± oyun gibi √∂ƒüren. √ñƒüren ‚Üí M√ºcadele‚Äôde puan topla.</div>

          <div style="height:14px"></div>
          <div class="progress">
            <div class="bar" id="progressBar" style="width: 55%;"></div>
          </div>
          <div class="muted small" style="margin-top:8px;"><span id="progressText">%55 tamamlandƒ±</span></div>
        </div>

        <div style="height:14px"></div>

        <!-- SECTIONS -->
        <section class="section" id="sec-home">
          <div class="tiles">
            <div class="tile" data-go="learn">
              <div class="t">√ñƒüren</div>
              <div class="d">√úniteleri bitir, kilitleri a√ß, mini quiz √ß√∂z.</div>
              <div class="muted small" style="margin-top:10px;">Ba≈üla ‚Üí</div>
            </div>
            <div class="tile" data-go="battle">
              <div class="t">M√ºcadele</div>
              <div class="d">Kahoot gibi: oda kur, drag-drop sorularla yarƒ±≈ü.</div>
              <div class="muted small" style="margin-top:10px;">Odaya gir ‚Üí</div>
            </div>
            <div class="tile" data-go="shop">
              <div class="t">D√ºkkan</div>
              <div class="d">ƒ∞pucu, ek can, zaman dondur gibi g√º√ßlendiriciler.</div>
              <div class="muted small" style="margin-top:10px;">G√∂z at ‚Üí</div>
            </div>
            <div class="tile" data-go="profile">
              <div class="t">Profil</div>
              <div class="d">ƒ∞statistik, rozetler, haftalƒ±k lig.</div>
              <div class="muted small" style="margin-top:10px;">G√∂r√ºnt√ºle ‚Üí</div>
            </div>
          </div>

          <div style="height:12px"></div>


        </section>

        <section class="section" id="sec-learn">
          <div class="row">
            <div>
              <div class="h2">√ñƒüren</div>
              <div class="muted small" style="margin-top:4px;">√úniteler (kilitler ba≈üarƒ±yla a√ßƒ±lƒ±r)</div>
            </div>
            <button class="btn secondary" data-go="home">Geri</button>
          </div>

          <div style="height:12px"></div>

          <div class="tiles">
            <div class="tile" onclick="openTopic('alkanlar')" style="cursor:pointer">
              <div class="t">Alkanlar</div>
              <div class="d">Ana zincir, numaralandƒ±rma, temel adlandƒ±rma.</div>
              <div class="progress" style="margin-top:12px;">
                <div class="bar" id="alkanlarProgressBar" style="width:0%"></div>
              </div>
              <div class="muted small" style="margin-top:8px;" id="alkanlarProgressText">%0 tamamlandƒ±</div>
            </div>

            <div class="tile locked-topic" id="tile-alkenler" style="opacity: 1; cursor: pointer;"
              onclick="tryOpenLockedTopic('alkenler')">
              <div class="t">Alkenler üîí</div>
              <div class="d">√áift baƒü kurallarƒ±</div>
              <div class="muted small" style="margin-top:10px;">√ñnce Alkanlar %80</div>
            </div>

            <div class="tile locked-topic" id="tile-alkinler" style="opacity: 1; cursor: pointer;"
              onclick="tryOpenLockedTopic('alkinler')">
              <div class="t">Alkinler üîí</div>
              <div class="d">√ú√ßl√º baƒü kurallarƒ±</div>
              <div class="muted small" style="margin-top:10px;">√ñnce Alkenler %60</div>
            </div>

            <div class="tile locked-topic" id="tile-arenler" style="opacity: 1; cursor: pointer;"
              onclick="tryOpenLockedTopic('arenler')">
              <div class="t">Arenler üîí</div>
              <div class="d">Aromatik temel</div>
              <div class="muted small" style="margin-top:10px;">√ñnce Alkinler %60</div>
            </div>
          </div>

          <div style="height:12px"></div>
          <div class="card pad">
            <div class="h2">Mini Quiz (demo)</div>
            <div class="muted small" style="margin-top:6px;">√áoktan se√ßmeli √∂rnek ‚Äî sonra drag-drop tiplerine baƒülanƒ±r.
            </div>
            <div style="height:10px"></div>
            <button class="btn" data-go="quiz">Quize Git</button>
          </div>
        </section>

        <section class="section" id="sec-battle">
          <div class="row">
            <div>
              <div class="h2">M√ºcadele</div>
              <div class="muted small" style="margin-top:4px;">Kahoot tarzƒ± oda + skor</div>
            </div>
            <button class="btn secondary" data-go="home">Geri</button>
          </div>

          <div style="height:12px"></div>

          <div class="tiles">
            <div class="tile">
              <div class="t">Hƒ±zlƒ± E≈üle≈üme</div>
              <div class="d">10 soru ‚Ä¢ s√ºreli ‚Ä¢ puan = hƒ±z + doƒüruluk</div>
              <div style="height:12px"></div>
              <button class="btn" onclick="alert('Demo: Buraya matchmaking gelecek üôÇ')">Ba≈ülat</button>
            </div>

            <div class="tile">
              <div class="t">Oda Kur</div>
              <div class="d">Konu/zorluk/s√ºre se√ß, kodla arkada≈ü davet et.</div>

              <div style="height:12px"></div>
              <div class="list">
                <div class="li">
                  <span class="muted small">Konu</span>
                  <select id="roomTopic"
                    style="width:160px; background:rgba(255,255,255,.06); color:white; border:1px solid var(--stroke); border-radius:12px; padding:8px;">
                    <option value="alkan">Alkanlar</option>
                    <option value="mixed">Karƒ±≈üƒ±k</option>
                  </select>
                </div>
                <div class="li">
                  <span class="muted small">S√ºre</span>
                  <select id="roomTime"
                    style="width:160px; background:rgba(255,255,255,.06); color:white; border:1px solid var(--stroke); border-radius:12px; padding:8px;">
                    <option value="60">60 sn</option>
                    <option value="90">90 sn</option>
                    <option value="120">120 sn</option>
                  </select>
                </div>
              </div>

              <div style="height:12px"></div>
              <button class="btn" onclick="createRoom()">Oda Olu≈ütur</button>
              <div class="muted small" id="roomOut" style="margin-top:10px;"></div>
            </div>
          </div>

          <div style="height:12px"></div>
          <div class="card pad">
            <div class="h2">Drag-drop soru ile dene</div>
            <div class="muted small" style="margin-top:6px;">Battle‚Äôda sorular buna benzer olacak.</div>
            <div style="height:10px"></div>
            <button class="btn" data-go="numbering">Numaralandƒ±rma Oyununa Git</button>
          </div>
        </section>

        <section class="section" id="sec-shop">
          <div class="row">
            <div>
              <div class="h2">D√ºkkan</div>
              <div class="muted small" style="margin-top:4px;">Jetonla g√º√ßlendirici al</div>
            </div>
            <button class="btn secondary" data-go="home">Geri</button>
          </div>

          <div style="height:12px"></div>

          <div class="card pad">
            <div class="list" id="shopList">
              <div class="li">
                <div style="display:flex;gap:12px;align-items:center">
                  <div
                    style="width:40px;height:40px;border-radius:12px;background:rgba(58,43,102,.7);display:grid;place-items:center;font-size:18px;border:1px solid var(--stroke)">
                    üí°</div>
                  <div>
                    <div style="font-weight:1000">ƒ∞pucu</div>
                    <div class="muted small">Bir adƒ±m ipucu al.</div>
                  </div>
                </div>
                <button class="btn secondary" style="height:42px" onclick="buy(25, 'ƒ∞pucu')">ü™ô 25</button>
              </div>
              <div class="li">
                <div style="display:flex;gap:12px;align-items:center">
                  <div
                    style="width:40px;height:40px;border-radius:12px;background:rgba(58,43,102,.7);display:grid;place-items:center;font-size:18px;border:1px solid var(--stroke)">
                    ‚ù§Ô∏è</div>
                  <div>
                    <div style="font-weight:1000">Ek Can</div>
                    <div class="muted small">Bir can ekle.</div>
                  </div>
                </div>
                <button class="btn secondary" style="height:42px" onclick="buy(50, 'Ek Can')">ü™ô 50</button>
              </div>
              <div class="li">
                <div style="display:flex;gap:12px;align-items:center">
                  <div
                    style="width:40px;height:40px;border-radius:12px;background:rgba(58,43,102,.7);display:grid;place-items:center;font-size:18px;border:1px solid var(--stroke)">
                    ‚è∏Ô∏è</div>
                  <div>
                    <div style="font-weight:1000">Zaman Dondur</div>
                    <div class="muted small">Battle‚Äôda +5 sn kazan.</div>
                  </div>
                </div>
                <button class="btn secondary" style="height:42px" onclick="buy(75, 'Zaman Dondur')">ü™ô 75</button>
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="sec-profile">
          <div class="row">
            <div>
              <div class="h2">Profil</div>
              <div class="muted small" style="margin-top:4px;">ƒ∞statistik + lig</div>
            </div>
            <button class="btn secondary" data-go="home">Geri</button>
          </div>

          <div style="height:12px"></div>

          <div class="tiles">
            <div class="card pad">
              <div class="h2">ƒ∞statistik</div>
              <div class="muted small" style="margin-top:10px; line-height:1.6" id="profileStats">
                <!-- Filled by JS -->
                Y√ºkleniyor...
              </div>
            </div>
            <div class="card pad">
              <div class="h2">Rozetler</div>
              <div id="badgesList" class="badges-grid">
                <!-- Filled by JS -->
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="sec-alkane-steps">
          <div class="row">
            <div>
              <div class="h2">Alkanlar - IUPAC Adlandƒ±rma</div>
              <div class="muted small" style="margin-top:4px;">Tek baƒülƒ± hidrokarbonlar</div>
            </div>
            <button class="btn secondary" data-go="learn">Geri</button>
          </div>

          <div style="height:12px"></div>

          <div class="list" id="alkaneStepsList">
            <div class="tile step-item  " data-step="1">
              <div class="row">
                <div style="display:flex;gap:12px;align-items:center">
                  <div class="step-badge">1</div>
                  <div>
                    <div class="t" style="font-size:16px;">Ana Zincir Belirleme</div>
                    <div class="muted small" style="margin-top:4px;">ƒ∞lk 10 alkan ve yapƒ± tanƒ±ma</div>
                  </div>
                </div>
                <span class="tag">Ba≈üla ‚Üí</span>
              </div>
            </div>
            <div class="tile step-item  locked" data-step="2">
              <div class="row">
                <div style="display:flex;gap:12px;align-items:center">
                  <div class="step-badge">2</div>
                  <div>
                    <div class="t" style="font-size:16px;">Yan Dal (Alkil Gruplarƒ±)</div>
                    <div class="muted small" style="margin-top:4px;">Metil, etil, propil ve √∂n ekler</div>
                  </div>
                </div>
                <span class="tag">üîí</span>
              </div>
            </div>
            <div class="tile step-item  locked" data-step="3">
              <div class="row">
                <div style="display:flex;gap:12px;align-items:center">
                  <div class="step-badge">3</div>
                  <div>
                    <div class="t" style="font-size:16px;">Numaralandƒ±rma</div>
                    <div class="muted small" style="margin-top:4px;">En k√º√ß√ºk numara kuralƒ±</div>
                  </div>
                </div>
                <span class="tag">üîí</span>
              </div>
            </div>
            <div class="tile step-item  locked" data-step="4">
              <div class="row">
                <div style="display:flex;gap:12px;align-items:center">
                  <div class="step-badge">4</div>
                  <div>
                    <div class="t" style="font-size:16px;">Alfabetik Sƒ±ralama</div>
                    <div class="muted small" style="margin-top:4px;">Dallarƒ± alfabetik sƒ±raya koy</div>
                  </div>
                </div>
                <span class="tag">üîí</span>
              </div>
            </div>
            <div class="tile step-item  locked" data-step="5">
              <div class="row">
                <div style="display:flex;gap:12px;align-items:center">
                  <div class="step-badge">5</div>
                  <div>
                    <div class="t" style="font-size:16px;">IUPAC Adlandƒ±rma</div>
                    <div class="muted small" style="margin-top:4px;">Tam ismi olu≈ütur</div>
                  </div>
                </div>
                <span class="tag">üîí</span>
              </div>
            </div>
          </div>

          <div style="height:12px"></div>
          <div class="card pad">
            <div class="progress">
              <div class="bar" id="alkaneProgress" style="width:0%"></div>
            </div>
            <div class="muted small" style="margin-top:8px;"><span id="alkaneProgressText">0/5 adƒ±m tamamlandƒ±</span>
            </div>
          </div>
        </section>

        <!-- STEP QUESTION SECTION -->
        <section class="section active" id="sec-alkane-question">
          <div class="row">
            <div>
              <div class="h2" id="stepTitle">Alkanlar - Adƒ±m 3: Numaralandƒ±rma</div>
              <div class="muted small" style="margin-top:4px;" id="stepSubtitle">Soru 5/7</div>
            </div>
            <button class="btn secondary" data-go="alkane-steps">Geri</button>
          </div>

          <div style="height:12px"></div>

          <div class="card pad quizBox">
            <div class="h2" id="stepQuestion">E≈üit uzaklƒ±kta hangisine k√º√ß√ºk numara verilir? (Tie-Breaker)</div>

            <div style="height:12px"></div>
            <div class="stage" id="stepMolecule" style="display: block;"><svg width="100%" height="220"
                viewBox="0 0 350 150" style="background:#2A2342; border-radius:12px;">
                <!-- 6 Carbon Chain -->
                <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                  <line x1="50" y1="75" x2="100" y2="75"></line>
                  <line x1="100" y1="75" x2="150" y2="75"></line>
                  <line x1="150" y1="75" x2="200" y2="75"></line>
                  <line x1="200" y1="75" x2="250" y2="75"></line>
                  <line x1="250" y1="75" x2="300" y2="75"></line>

                  <!-- Branches: C3 (Ethyl) and C4 (Methyl) -->
                  <!-- Left-to-Right: C3 is Ethyl. Right-to-Left: C3 (from right) is Methyl node C4 -->

                  <!-- C3 branch (Ethyl) -->
                  <line x1="150" y1="75" x2="150" y2="35"></line>
                  <line x1="150" y1="35" x2="150" y2="5"></line>

                  <!-- C4 branch (Methyl) -->
                  <line x1="200" y1="75" x2="200" y2="35"></line>
                </g>
                <g class="atoms">
                  <circle cx="50" cy="75" r="12" class="atom" data-id="c1"
                    style="cursor: default; stroke: rgba(56, 217, 169, 0.8);" fill="var(--success)"></circle>
                  <circle cx="100" cy="75" r="12" class="atom" data-id="c2"
                    style="cursor: default; stroke: rgba(56, 217, 169, 0.8);" fill="var(--success)"></circle>
                  <circle cx="150" cy="75" r="12" class="atom" data-id="c3"
                    style="cursor: default; stroke: rgba(56, 217, 169, 0.8);" fill="var(--success)"></circle>
                  <circle cx="200" cy="75" r="12" class="atom" data-id="c4"
                    style="cursor: default; stroke: rgba(56, 217, 169, 0.8);" fill="var(--success)"></circle>
                  <circle cx="250" cy="75" r="12" class="atom" data-id="c5"
                    style="cursor: default; stroke: rgba(56, 217, 169, 0.8);" fill="var(--success)"></circle>
                  <circle cx="300" cy="75" r="12" class="atom" data-id="c6"
                    style="cursor: default; stroke: rgba(56, 217, 169, 0.8);" fill="var(--success)"></circle>

                  <!-- Subs -->
                  <circle cx="150" cy="35" r="10" class="atom sub" fill="" style="cursor: default;"></circle>
                  <!-- Ethyl C1 -->
                  <circle cx="150" cy="5" r="10" class="atom sub" fill="" style="cursor: default;"></circle>
                  <!-- Ethyl C2 -->

                  <circle cx="200" cy="35" r="10" class="atom sub" fill="" style="cursor: default;"></circle>
                  <!-- Methyl -->

                  <text x="150" y="25" fill="white" font-size="10" text-anchor="middle"
                    style="pointer-events:none">Etil</text>
                  <text x="200" y="25" fill="white" font-size="10" text-anchor="middle"
                    style="pointer-events:none">Metil</text>
                </g>
                <text x="50" y="80" text-anchor="middle" class="num-label" fill="white" font-weight="bold"
                  font-size="16" style="pointer-events: none;">1</text><text x="100" y="80" text-anchor="middle"
                  class="num-label" fill="white" font-weight="bold" font-size="16"
                  style="pointer-events: none;">2</text><text x="150" y="80" text-anchor="middle" class="num-label"
                  fill="white" font-weight="bold" font-size="16" style="pointer-events: none;">3</text><text x="200"
                  y="80" text-anchor="middle" class="num-label" fill="white" font-weight="bold" font-size="16"
                  style="pointer-events: none;">4</text><text x="250" y="80" text-anchor="middle" class="num-label"
                  fill="white" font-weight="bold" font-size="16" style="pointer-events: none;">5</text><text x="300"
                  y="80" text-anchor="middle" class="num-label" fill="white" font-weight="bold" font-size="16"
                  style="pointer-events: none;">6</text>
              </svg></div>

            <div style="height:12px"></div>
            <div class="choices" id="stepChoices">
              <div style="display:flex; justify-content:center; align-items:center; gap:16px; margin-bottom:12px;">
                <div class="pill" id="numModeBadge" style="background:var(--primary); cursor:default;">
                  <span>1Ô∏è‚É£</span> <span>Sƒ±radaki: 7</span>
                </div>
                <div class="muted small">Tƒ±kla: Sayƒ± ver</div>
              </div>
              <div class="muted small" style="text-align:center">Yanlƒ±≈ü verdiƒüin sayƒ±ya tekrar tƒ±klayarak o sayƒ±dan
                sonrasƒ±nƒ± silebilirsin.</div>
            </div>

            <div style="height:10px"></div>
            <div id="stepNotice" class="notice ok" style="display: block;">Doƒüru! üéâ +5 jeton</div>

            <div style="height:12px"></div>
            <div class="row">
              <button class="btn" id="stepCheck" onclick="checkStepAnswer()" style="display: none;">Kontrol Et</button>
              <button class="btn secondary" id="stepNext" style="display: inline-flex;"
                onclick="nextStepQuestion()">Sonraki
                Soru ‚Üí</button>
            </div>

            <div style="height:12px"></div>
            <div class="hint" id="stepHint"
              data-hint="üí° Dallar u√ßlara e≈üit uzaklƒ±kta (Sola 3, Saƒüa 3). Bu durumda ALFABETƒ∞K √∂nceliƒüi olan (Etil) k√º√ß√ºk numarayƒ± alƒ±r!"
              style="display: block;">üí° Dallar u√ßlara e≈üit uzaklƒ±kta (Sola 3, Saƒüa 3). Bu durumda ALFABETƒ∞K √∂nceliƒüi
              olan (Etil) k√º√ß√ºk numarayƒ± alƒ±r!</div>
          </div>
        </section>

        <section class="section" id="sec-quiz">
          <div class="row">
            <div>
              <div class="h2">Quiz (demo)</div>
              <div class="muted small" style="margin-top:4px;">√áoktan se√ßmeli √∂rnek</div>
            </div>
            <button class="btn secondary" data-go="learn">Geri</button>
          </div>

          <div style="height:12px"></div>

          <div class="card pad quizBox">
            <div class="h2" id="qPrompt">Bu bile≈üiƒüin adƒ± nedir?</div>
            <div class="formula" id="qFormula">CH‚ÇÉ‚ÄîCH‚ÇÇ‚ÄîCH‚ÇÇ‚ÄîCH‚ÇÉ</div>

            <div class="choices" id="qChoices"><button class="choice">Metan</button><button
                class="choice">Etan</button><button class="choice">Propan</button><button class="choice">B√ºtan</button>
            </div>

            <div style="height:10px"></div>
            <div id="qNotice" class="notice" style="display:none;"></div>

            <div style="height:12px"></div>
            <button class="btn" id="qCheck" disabled="">Kontrol Et</button>
          </div>
        </section>

        <section class="section" id="sec-numbering">
          <div class="row">
            <div>
              <div class="h2">Numaralandƒ±rma (drag-drop + mobil tap)</div>
              <div class="muted small" style="margin-top:4px;">Etiket se√ß ‚Üí karbon slotuna yerle≈ütir</div>
            </div>
            <button class="btn secondary" data-go="learn">Geri</button>
          </div>

          <div style="height:12px"></div>

          <div class="gameWrap">
            <div class="stage">
              <!-- Simple chain: 4 carbon nodes -->
              <svg viewBox="0 0 720 320" aria-label="Karbon zinciri">
                <!-- bonds -->
                <g stroke="rgba(255,255,255,.35)" stroke-width="12" stroke-linecap="round">
                  <line x1="170" y1="160" x2="290" y2="160"></line>
                  <line x1="290" y1="160" x2="410" y2="160"></line>
                  <line x1="410" y1="160" x2="530" y2="160"></line>
                </g>

                <!-- nodes -->
                <g fill="rgba(255,255,255,.18)" stroke="rgba(255,255,255,.12)" stroke-width="2">
                  <circle cx="170" cy="160" r="34"></circle>
                  <circle cx="290" cy="160" r="34"></circle>
                  <circle cx="410" cy="160" r="34"></circle>
                  <circle cx="530" cy="160" r="34"></circle>
                </g>

                <!-- slots (clickable) -->
                <g class="slot" data-node="c1" onclick="placeNumber('c1')">
                  <circle class="slotRing" id="ring-c1" cx="170" cy="90" r="26"></circle>
                  <text class="slotFill" id="txt-c1" x="170" y="98" text-anchor="middle" font-size="26">?</text>
                </g>
                <g class="slot" data-node="c2" onclick="placeNumber('c2')">
                  <circle class="slotRing" id="ring-c2" cx="290" cy="90" r="26"></circle>
                  <text class="slotFill" id="txt-c2" x="290" y="98" text-anchor="middle" font-size="26">?</text>
                </g>
                <g class="slot" data-node="c3" onclick="placeNumber('c3')">
                  <circle class="slotRing" id="ring-c3" cx="410" cy="90" r="26"></circle>
                  <text class="slotFill" id="txt-c3" x="410" y="98" text-anchor="middle" font-size="26">?</text>
                </g>
                <g class="slot" data-node="c4" onclick="placeNumber('c4')">
                  <circle class="slotRing" id="ring-c4" cx="530" cy="90" r="26"></circle>
                  <text class="slotFill" id="txt-c4" x="530" y="98" text-anchor="middle" font-size="26">?</text>
                </g>

                <!-- label -->
                <text x="360" y="265" text-anchor="middle" fill="rgba(255,255,255,.7)" font-weight="900">
                  G√∂rev: Zinciri soldan saƒüa 1-2-3-4 numaralandƒ±r.
                </text>
              </svg>
            </div>

            <div class="card pad">
              <div class="row">
                <div>
                  <div class="h2">Etiketler</div>
                  <div class="hint" style="margin-top:6px;">
                    <b>Mobil:</b> √∂nce bir etikete dokun (se√ß), sonra slot‚Äôa dokun.<br>
                    <b>Desktop:</b> s√ºr√ºkleyip slot‚Äôa bƒ±rakabilirsin (isteƒüe baƒülƒ±).
                  </div>
                </div>
              </div>

              <div style="height:12px"></div>
              <div class="tokenRow" id="tokens">
                <div class="token" data-val="1" draggable="true">1</div>
                <div class="token" data-val="2" draggable="true">2</div>
                <div class="token" data-val="3" draggable="true">3</div>
                <div class="token" data-val="4" draggable="true">4</div>
              </div>

              <div style="height:12px"></div>
              <div class="row">
                <button class="btn" onclick="checkNumbering()">Kontrol Et</button>
                <button class="btn secondary" onclick="resetNumbering()">Sƒ±fƒ±rla</button>
              </div>

              <div style="height:12px"></div>
              <div id="numNotice" class="notice" style="display:none;"></div>

              <div style="height:12px"></div>
              <div class="hint">
                ƒ∞pucu: √áift/√º√ßl√º baƒü olsaydƒ± <span class="kbd">en k√º√ß√ºk numara</span> kuralƒ± devreye girerdi.
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- RIGHT PANEL (desktop) -->
      <aside class="rp sticky" style="display: none;" id="deskRight">


        <div class="card pad league">
          <div class="h2">Haftalƒ±k Lig</div>
          <div style="height:10px"></div>
          <div class="list" id="leagueList">
            <!-- Dynamic League Content -->
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- MOBILE NAV -->
  <div class="bottomNav">
    <div class="bar">
      <button data-go="home" class=""><span class="icon">üè†</span><span class="small">Ana</span></button>
      <button data-go="learn" class=""><span class="icon">üìö</span><span class="small">√ñƒüren</span></button>
      <button data-go="battle"><span class="icon">‚öîÔ∏è</span><span class="small">M√ºcadele</span></button>
      <button data-go="shop"><span class="icon">üõí</span><span class="small">D√ºkkan</span></button>
      <button data-go="profile"><span class="icon">üë§</span><span class="small">Profil</span></button>
    </div>
  </div>

  <script>
    // ---------- Developer Mode ----------
    let devMode = false;

    function toggleDevMode() {
      devMode = !devMode;
      console.log(`üîß Dev Mode: ${devMode ? 'A√áIK' : 'KAPALI'}`);
      if (devMode) {
        console.log('%cüîß DEV MODE A√áIK', 'background: #7C5CFF; color: white; padding: 4px 8px; border-radius: 4px;');
        console.log('Komutlar:');
        console.log('  - devSkip() : Soruyu atla');
        console.log('  - devUnlockAll() : T√ºm adƒ±mlarƒ± a√ß');
        console.log('  - devComplete() : Mevcut adƒ±mƒ± tamamla');
        console.log('  - devReset() : ƒ∞lerlemeyi sƒ±fƒ±rla');
        console.log('Kƒ±sayollar:');
        console.log('  - S : Soruyu atla');
        console.log('  - U : T√ºm adƒ±mlarƒ± a√ß');
      }
      updateDevUI();
    }

    function devSkip() {
      if (!devMode) return console.log('Dev mode kapalƒ±!');
      if (state.route === 'alkane-question') {
        nextStepQuestion();
        console.log('‚è≠Ô∏è Soru atlandƒ±');
      }
    }

    function devUnlockAll() {
      if (!devMode) return console.log('Dev mode kapalƒ±!');

      // Unlock all topics and steps
      Object.keys(topicsData.topics).forEach(key => {
        const topic = topicsData.topics[key];
        topicsData.progress[key] = topic.steps.map(s => s.id);
      });

      renderTopicSteps();
      updateDevUI();
      console.log('üîì T√ºm konular ve adƒ±mlar a√ßƒ±ldƒ±');
    }

    function devComplete() {
      if (!devMode) return console.log('Dev mode kapalƒ±!');

      const topicId = topicsData.currentTopic;
      const currentStep = topicsData.currentStep;
      const progressList = topicsData.progress[topicId];

      if (!progressList.includes(currentStep)) {
        progressList.push(currentStep);
      }

      go('alkane-steps');
      renderTopicSteps();
      console.log(`‚úÖ Adƒ±m ${currentStep} tamamlandƒ±`);
    }

    function devReset() {
      if (!devMode) return console.log('Dev mode kapalƒ±!');
      alkaneSteps.completedSteps = [];
      state.coins = 100;
      state.hearts = 3;
      state.progress = 55;
      syncTop();
      renderAlkaneSteps();
      console.log('üîÑ ƒ∞lerleme sƒ±fƒ±rlandƒ±');
    }

    function updateDevUI() {
      // Add/remove dev mode indicator
      let indicator = document.getElementById('devIndicator');
      if (devMode && !indicator) {
        indicator = document.createElement('div');
        indicator.id = 'devIndicator';
        indicator.style.cssText = `
          position: fixed; top: 10px; right: 10px; z-index: 999;
          background: var(--primary); color: white; padding: 6px 12px;
          border-radius: 999px; font-size: 12px; font-weight: 900;
          cursor: pointer;
        `;
        indicator.textContent = 'üîß DEV';
        indicator.onclick = toggleDevMode;
        document.body.appendChild(indicator);
      } else if (!devMode && indicator) {
        indicator.remove();
      }

      // Update skip button visibility
      const skipBtn = document.getElementById('devSkipBtn');
      if (skipBtn) skipBtn.style.display = devMode ? 'inline-flex' : 'none';

      // Update locked topic tiles
      document.querySelectorAll('.locked-topic').forEach(tile => {
        if (devMode) {
          tile.style.opacity = '1';
          tile.style.cursor = 'pointer';
        } else {
          tile.style.opacity = '0.6';
          tile.style.cursor = 'not-allowed';
        }
      });
    }

    // Try to open locked topic (only works in dev mode)
    function tryOpenLockedTopic(topic) {
      if (!devMode) {
        console.log('üîí Bu konu kilitli. Dev mode a√ßƒ±n: Ctrl+Shift+D');
        return;
      }

      console.log(`üîì [DEV] ${topic} a√ßƒ±lƒ±yor...`);

      // Set current topic and navigate to its steps
      topicsData.currentTopic = topic;
      go('alkane-steps');
      renderTopicSteps();
      console.log(`‚úÖ [DEV] "${topic}" konusu a√ßƒ±ldƒ±`);
    }

    // Generic function to open any topic
    function openTopic(topicId) {
      const topic = topicsData.topics[topicId];
      if (!topic) return;

      if (!devMode && topic.locked) {
        console.log('üîí Bu konu kilitli.');
        return;
      }

      topicsData.currentTopic = topicId;
      go('alkane-steps');
      renderTopicSteps();
    }

    function renderLeague() {
      const list = document.getElementById('leagueList');
      if (!list) return;
      list.innerHTML = `
        <div class="li" style="border-color:var(--primary); background:rgba(124, 92, 255, .1);">
            <span>${state.userDisplayName} (Siz)</span>
            <span class="muted">${state.battleScore}</span>
        </div>
      `;
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      // Ctrl+Shift+D to toggle dev mode
      if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        e.preventDefault();
        toggleDevMode();
      }

      if (!devMode) return;

      // S to skip question
      if (e.key === 's' || e.key === 'S') {
        if (!e.ctrlKey && state.route === 'alkane-question') {
          devSkip();
        }
      }

      // U to unlock all
      if (e.key === 'u' || e.key === 'U') {
        if (!e.ctrlKey) {
          devUnlockAll();
        }
      }
    });

    // ---------- App State ----------
    const state = {
      hearts: 3,
      hearts: 3,
      coins: 100,
      battleScore: 0,
      userDisplayName: "Siz",
      progress: 0,
      route: "home",
      quiz: {
        selected: null,
        status: "idle",
        data: {
          prompt: "Bu bile≈üiƒüin adƒ± nedir?",
          formula: "CH‚ÇÉ‚ÄîCH‚ÇÇ‚ÄîCH‚ÇÇ‚ÄîCH‚ÇÉ",
          choices: [
            { id: "metan", label: "Metan" },
            { id: "etan", label: "Etan" },
            { id: "propan", label: "Propan" },
            { id: "butan", label: "B√ºtan" },
          ],
          answerId: "butan",
        }
      },
      numbering: {
        selectedToken: null,
        slots: { c1: null, c2: null, c3: null, c4: null },
        correct: { c1: "1", c2: "2", c3: "3", c4: "4" }
      },
      badges: [
        { id: 'start', icon: 'üöÄ', title: 'Ba≈ülangƒ±√ß', desc: 'ƒ∞lk adƒ±mƒ± tamamla.', unlocked: false },
        { id: 'rich', icon: 'üíé', title: 'Zengin', desc: '150 jetona ula≈ü.', unlocked: false },
        { id: 'nerd', icon: 'ü§ì', title: 'Alkan Ustasƒ±', desc: 'Alkanlar √ºnitesini bitir.', unlocked: false },
        { id: 'onfire', icon: 'üî•', title: 'Alev Aldƒ±', desc: '10 soru √ºst √ºste doƒüru yap.', unlocked: false }, // Placeholder logic
        { id: 'social', icon: 'ü§ù', title: 'Sosyal', desc: 'Bir odaya katƒ±l (Demo).', unlocked: false }
      ]
    };

    // Mascot image paths
    const mascotImages = {
      happy: 'assets/maskot2.png',
      thinking: 'assets/maskot2.png',
      encouraging: 'assets/maskot2.png',
      neutral: 'assets/maskot2.png',
      celebrating: 'assets/maskot2.png'
    };

    function getMascotHTML(type, message) {
      const img = mascotImages[type] || mascotImages.neutral;
      return `
        <div class="mascot-container">
          <img src="${img}" alt="Maskot" class="mascot-img">
          <div class="mascot-bubble">
            <div class="mascot-text">${message}</div>
          </div>
        </div>
      `;
    }

    function checkBadges() {
      let anyUnlock = false;
      const b = state.badges;

      // Logic: Start
      if (!b.find(x => x.id === 'start').unlocked && alkaneSteps.completedSteps.length > 0) {
        b.find(x => x.id === 'start').unlocked = true;
        anyUnlock = true;
        alert("üèÖ Rozet Kazanƒ±ldƒ±: Ba≈ülangƒ±√ß!");
      }

      // Logic: Rich
      if (!b.find(x => x.id === 'rich').unlocked && state.coins >= 150) {
        b.find(x => x.id === 'rich').unlocked = true;
        anyUnlock = true;
        alert("üèÖ Rozet Kazanƒ±ldƒ±: Zengin!");
      }

      // Logic: Nerd (All steps in alkanes)
      const totalSteps = topicsData.topics.alkanlar.steps.length;
      if (!b.find(x => x.id === 'nerd').unlocked && alkaneSteps.completedSteps.length >= totalSteps) {
        b.find(x => x.id === 'nerd').unlocked = true;
        anyUnlock = true;
        alert("üèÖ Rozet Kazanƒ±ldƒ±: Alkan Ustasƒ±!");
      }

      if (anyUnlock) {
        // Save if adding localstorage later
      }
    }

    function renderProfile() {
      // 1. Update stats
      const container = document.getElementById("profileStats");
      if (container) {
        // Mock data for now, mix with real
        const acc = state.battleScore > 0 ? "85" : "0";
        container.innerHTML = `
           Toplam XP: <b>${state.coins * 10}</b><br>
           Doƒüru oranƒ±: <b>%${acc}</b><br>
           Seri: <b>${state.progress > 0 ? 1 : 0} g√ºn</b>
        `;
      }

      // 2. Render Badges
      const grid = document.getElementById("badgesList");
      if (grid) {
        grid.innerHTML = state.badges.map(b => `
          <div class="badge-item ${b.unlocked ? 'unlocked' : 'locked'}">
            <div class="badge-icon">${b.icon}</div>
            <div class="badge-title">${b.title}</div>
            ${!b.unlocked ? `<div style="font-size:9px; opacity:0.7">üîí ${b.desc}</div>` : ''}
          </div>
        `).join('');
      }
    }

    function syncTop() {
      document.getElementById("heartsVal").textContent = state.hearts;
      document.getElementById("coinsVal").textContent = state.coins;

      // Calculate real progress based on Alkanes topic (since it's the main active one)
      const totalSteps = topicsData.topics.alkanlar ? topicsData.topics.alkanlar.steps.length : 1;
      const completed = alkaneSteps.completedSteps.length;
      state.progress = Math.floor((completed / totalSteps) * 100);

      const b = document.getElementById("progressBar");
      // Global progress bar (hero)
      if (b) b.style.width = state.progress + "%";
      const pt = document.getElementById("progressText");
      if (pt) pt.textContent = `%${state.progress} tamamlandƒ±`;

      // Alkanlar topic card progress
      const alkBar = document.getElementById("alkanlarProgressBar");
      const alkText = document.getElementById("alkanlarProgressText");
      if (alkBar) alkBar.style.width = state.progress + "%";
      if (alkText) alkText.textContent = `%${state.progress} tamamlandƒ±`;

      // Right panel progress bar
      const b2 = document.querySelector('.rp .progress .bar');
      if (b2) b2.style.width = state.progress + "%";
      const pt2 = document.querySelector('.rp .muted.small');
      if (pt2) pt2.textContent = `%${state.progress} tamamlandƒ±`;

      renderLeague();

      const hv2 = document.getElementById("heartsVal2");
      const cv2 = document.getElementById("coinsVal2");
      if (hv2) hv2.textContent = state.hearts;
      if (cv2) cv2.textContent = state.coins;

      checkBadges();
      if (state.route === "profile") renderProfile();
    }

    // ---------- Routing ----------
    const sections = {
      home: document.getElementById("sec-home"),
      learn: document.getElementById("sec-learn"),
      battle: document.getElementById("sec-battle"),
      shop: document.getElementById("sec-shop"),
      profile: document.getElementById("sec-profile"),
      quiz: document.getElementById("sec-quiz"),
      numbering: document.getElementById("sec-numbering"),
      "alkane-steps": document.getElementById("sec-alkane-steps"),
      "alkane-question": document.getElementById("sec-alkane-question"),
    };

    function go(route) {
      state.route = route;
      Object.entries(sections).forEach(([k, el]) => {
        el.classList.toggle("active", k === route);
      });

      // mobile nav active
      document.querySelectorAll(".bottomNav button").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.go === route);
      });

      // special renders
      if (route === "shop") renderShop();
      if (route === "quiz") renderQuiz();
      if (route === "numbering") renderNumbering();
      if (route === "profile") renderProfile();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // click bindings
    document.body.addEventListener("click", (e) => {
      const t = e.target.closest("[data-go]");
      if (!t) return;
      const route = t.dataset.go;
      go(route);
    });

    // Desktop sidebar show/hide
    function updateDesktopVisibility() {
      const isDesk = window.matchMedia("(min-width: 1024px)").matches;
      document.getElementById("deskSidebar").style.display = isDesk ? "block" : "none";
      document.getElementById("deskRight").style.display = isDesk ? "block" : "none";
    }
    window.addEventListener("resize", updateDesktopVisibility);

    // Desktop nav render
    function renderDesktopNav() {
      const items = [
        { key: "home", label: "Ana Sayfa", icon: "üè†" },
        { key: "learn", label: "√ñƒüren", icon: "üìö" },
        { key: "battle", label: "M√ºcadele", icon: "‚öîÔ∏è" },
        { key: "shop", label: "D√ºkkan", icon: "üõí" },
        { key: "profile", label: "Profil", icon: "üë§" },
      ];
      const wrap = document.getElementById("deskNav");
      wrap.innerHTML = "";
      items.forEach(it => {
        const div = document.createElement("div");
        div.className = "item" + (state.route === it.key ? " active" : "");
        div.innerHTML = `<span class="icon">${it.icon}</span><span>${it.label}</span>`;
        div.onclick = () => { go(it.key); renderDesktopNav(); };
        wrap.appendChild(div);
      });
    }

    // ---------- Shop ----------
    const shopItems = [
      { icon: "üí°", name: "ƒ∞pucu", price: 25, desc: "Bir adƒ±m ipucu al." },
      { icon: "‚ù§Ô∏è", name: "Ek Can", price: 50, desc: "Bir can ekle." },
      { icon: "‚è∏Ô∏è", name: "Zaman Dondur", price: 75, desc: "Battle‚Äôda +5 sn kazan." },
    ];

    function renderShop() {
      const list = document.getElementById("shopList");
      list.innerHTML = "";
      shopItems.forEach(item => {
        const el = document.createElement("div");
        el.className = "li";
        el.innerHTML = `
          <div style="display:flex;gap:12px;align-items:center">
            <div style="width:40px;height:40px;border-radius:12px;background:rgba(58,43,102,.7);display:grid;place-items:center;font-size:18px;border:1px solid var(--stroke)">${item.icon}</div>
            <div>
              <div style="font-weight:1000">${item.name}</div>
              <div class="muted small">${item.desc}</div>
            </div>
          </div>
          <button class="btn secondary" style="height:42px" onclick="buy(${item.price}, '${item.name.replace(/'/g, "\\'")}')">ü™ô ${item.price}</button>
        `;
        list.appendChild(el);
      });
    }

    function buy(price, name) {
      if (state.coins < price) {
        alert("Yetersiz jeton üòÖ");
        return;
      }
      state.coins -= price;
      syncTop();
      alert(`${name} satƒ±n alƒ±ndƒ±!`);
    }

    // ---------- Quiz ----------
    function renderQuiz() {
      const q = state.quiz.data;
      state.quiz.selected = null;
      state.quiz.status = "idle";

      document.getElementById("qPrompt").textContent = q.prompt;
      document.getElementById("qFormula").textContent = q.formula;

      const choices = document.getElementById("qChoices");
      const notice = document.getElementById("qNotice");
      const checkBtn = document.getElementById("qCheck");

      notice.style.display = "none";
      checkBtn.disabled = true;

      choices.innerHTML = "";
      q.choices.forEach(c => {
        const b = document.createElement("button");
        b.className = "choice";
        b.textContent = c.label;
        b.onclick = () => {
          state.quiz.selected = c.id;
          document.querySelectorAll(".choice").forEach(x => x.classList.remove("selected"));
          b.classList.add("selected");
          checkBtn.disabled = false;
        };
        choices.appendChild(b);
      });

      checkBtn.onclick = () => {
        const ok = state.quiz.selected === q.answerId;
        notice.style.display = "block";
        notice.className = "notice " + (ok ? "ok" : "bad");
        notice.textContent = ok ? "Doƒüru! üéâ +10 XP (demo)" : "Yanlƒ±≈ü üôÇ Tekrar dene.";
        if (ok) {
          state.coins += 5;
          state.progress = Math.min(100, state.progress + 1);
          syncTop();
        }
      };
    }

    // ---------- Battle room demo ----------
    function createRoom() {
      const topic = document.getElementById("roomTopic").value;
      const time = document.getElementById("roomTime").value;
      const code = Math.random().toString(36).slice(2, 7).toUpperCase();
      document.getElementById("roomOut").textContent =
        `Oda olu≈üturuldu ‚úÖ Kod: ${code} ‚Ä¢ Konu: ${topic} ‚Ä¢ S√ºre: ${time} sn`;
    }

    // ---------- Numbering Game ----------
    function renderNumbering() {
      // tokens
      const tokens = document.getElementById("tokens");
      tokens.innerHTML = "";
      ["1", "2", "3", "4"].forEach(n => {
        const t = document.createElement("div");
        t.className = "token";
        t.textContent = n;
        t.dataset.val = n;

        // mobile tap select
        t.addEventListener("click", () => {
          state.numbering.selectedToken = n;
          document.querySelectorAll(".token").forEach(x => x.classList.remove("selected"));
          t.classList.add("selected");
        });

        // optional desktop drag-drop hooks (kept minimal)
        t.draggable = true;
        t.addEventListener("dragstart", (e) => {
          e.dataTransfer.setData("text/plain", n);
        });
        tokens.appendChild(t);
      });

      // reset view
      Object.keys(state.numbering.slots).forEach(k => {
        state.numbering.slots[k] = null;
        document.getElementById("txt-" + k).textContent = "?";
        document.getElementById("ring-" + k).classList.remove("ok", "bad");
      });

      const note = document.getElementById("numNotice");
      note.style.display = "none";
      state.numbering.selectedToken = null;
      document.querySelectorAll(".token").forEach(x => x.classList.remove("selected"));

      // Allow drop on slots (desktop)
      ["c1", "c2", "c3", "c4"].forEach(nodeId => {
        const g = document.querySelector(`g.slot[data-node="${nodeId}"]`);
        g.addEventListener("dragover", (e) => e.preventDefault());
        g.addEventListener("drop", (e) => {
          e.preventDefault();
          const n = e.dataTransfer.getData("text/plain");
          state.numbering.selectedToken = n;
          placeNumber(nodeId);
        });
      });
    }

    function placeNumber(nodeId) {
      const n = state.numbering.selectedToken;
      if (!n) {
        flashNumNotice("√ñnce bir etiket se√ß üôÇ", "bad");
        return;
      }
      // prevent same number used twice
      const used = Object.values(state.numbering.slots).includes(n);
      if (used) {
        flashNumNotice("Bu numara zaten kullanƒ±ldƒ±. Ba≈üka se√ß.", "bad");
        return;
      }
      state.numbering.slots[nodeId] = n;
      document.getElementById("txt-" + nodeId).textContent = n;
      flashNumNotice(`Yerle≈ütirildi: ${n}`, "");
    }

    function checkNumbering() {
      const slots = state.numbering.slots;
      const corr = state.numbering.correct;

      let allFilled = true;
      let okCount = 0;

      Object.keys(slots).forEach(k => {
        const ring = document.getElementById("ring-" + k);
        ring.classList.remove("ok", "bad");

        if (!slots[k]) allFilled = false;
        if (slots[k] && slots[k] === corr[k]) {
          okCount++;
          ring.classList.add("ok");
        } else if (slots[k]) {
          ring.classList.add("bad");
        }
      });

      if (!allFilled) {
        flashNumNotice("Hepsini doldurmalƒ±sƒ±n (4 slot).", "bad");
        return;
      }
      if (okCount === 4) {
        flashNumNotice("M√ºkemmel! ‚úÖ +10 jeton (demo)", "ok");
        state.coins += 10;
        state.progress = Math.min(100, state.progress + 2);
        syncTop();
      } else {
        flashNumNotice(`Kƒ±smi doƒüru: ${okCount}/4. Tekrar dene üôÇ`, "bad");
      }
    }

    function resetNumbering() {
      renderNumbering();
    }

    function flashNumNotice(msg, type) {
      const note = document.getElementById("numNotice");
      note.style.display = "block";
      note.className = "notice " + (type || "");
      note.textContent = msg;
      if (!type) {
        // subtle (no color)
        note.className = "notice";
      }
    }

    // ---------- Boot ----------
    function init() {
      go("home"); // Her zaman anasayfadan ba≈üla
      syncTop();
      updateDesktopVisibility();
      renderDesktopNav();
      renderShop(); // preload ok
      renderQuiz(); // preload ok
      renderNumbering(); // preload ok
      renderAlkaneSteps(); // preload ok

      // keep desktop nav active synced when route changes from other buttons
      const origGo = go;
      window.go = (r) => {
        origGo(r);
        renderDesktopNav();
      };
    }

    // ---------- Multi-Topic Step Learning System ----------
    const topicsData = {
      currentTopic: 'alkanlar',
      currentStep: 1,
      currentQuestionIndex: 0,
      selectedAnswer: null,
      activeQuestions: [],
      interactiveQuestions: [
        {
          type: "chain_selection",
          question: "Bu molek√ºldeki en uzun karbon zincirini (ana zinciri) se√ßin.",
          moleculeSVG: `<svg viewBox="0 0 400 200" style="background:rgba(0,0,0,0.2); border-radius:12px;">
            <g class="bonds">
              <line x1="50" y1="100" x2="110" y2="100" class="bond" />
              <line x1="110" y1="100" x2="170" y2="100" class="bond" />
              <line x1="170" y1="100" x2="230" y2="100" class="bond" />
              <line x1="230" y1="100" x2="290" y2="100" class="bond" />
              <line x1="170" y1="100" x2="170" y2="50" class="bond" />
            </g>
            <g class="atoms">
              <circle cx="50" cy="100" r="18" class="atom" id="c1" data-id="c1" />
              <circle cx="110" cy="100" r="18" class="atom" id="c2" data-id="c2" />
              <circle cx="170" cy="100" r="18" class="atom" id="c3" data-id="c3" />
              <circle cx="230" cy="100" r="18" class="atom" id="c4" data-id="c4" />
              <circle cx="290" cy="100" r="18" class="atom" id="c5" data-id="c5" />
              <circle cx="170" cy="50" r="18" class="atom" id="c6" data-id="c6" />
            </g>
          </svg>`,
          correctChain: ["c1", "c2", "c3", "c4", "c5"],
          hint: "üí° En uzun zincir 5 karbonludur (yatay olan)."
        },
        {
          type: "chain_selection",
          question: "En uzun zinciri i≈üaretleyin. Dikkat: Kƒ±vrƒ±mlƒ± olabilir!",
          moleculeSVG: `<svg viewBox="0 0 400 200" style="background:rgba(0,0,0,0.2); border-radius:12px;">
            <g class="bonds">
              <line x1="60" y1="150" x2="120" y2="150" class="bond" />
              <line x1="120" y1="150" x2="120" y2="90" class="bond" />
              <line x1="120" y1="90" x2="180" y2="90" class="bond" />
              <line x1="180" y1="90" x2="240" y2="90" class="bond" />
              <line x1="240" y1="90" x2="240" y2="150" class="bond" />
              <line x1="180" y1="90" x2="180" y2="40" class="bond" />
            </g>
            <g class="atoms">
              <circle cx="60" cy="150" r="18" class="atom" id="c1" data-id="c1" />
              <circle cx="120" cy="150" r="18" class="atom" id="c2" data-id="c2" />
              <circle cx="120" cy="90" r="18" class="atom" id="c3" data-id="c3" />
              <circle cx="180" cy="90" r="18" class="atom" id="c4" data-id="c4" />
              <circle cx="240" cy="90" r="18" class="atom" id="c5" data-id="c5" />
              <circle cx="240" cy="150" r="18" class="atom" id="c6" data-id="c6" />
              <circle cx="180" cy="40" r="18" class="atom" id="c7" data-id="c7" />
            </g>
          </svg>`,
          correctChain: ["c1", "c2", "c3", "c4", "c5", "c6"],
          hint: "üí° En uzun zincir U ≈üeklindedir ve 6 karbonludur."
        },
        {
          type: "chain_selection",
          question: "Ana zinciri se√ßin (Dallanmalara dikkat).",
          moleculeSVG: `<svg viewBox="0 0 400 200" style="background:rgba(0,0,0,0.2); border-radius:12px;">
            <g class="bonds">
              <line x1="40" y1="100" x2="100" y2="100" class="bond" />
              <line x1="100" y1="100" x2="160" y2="100" class="bond" />
              <line x1="160" y1="100" x2="220" y2="100" class="bond" />
              <line x1="220" y1="100" x2="280" y2="100" class="bond" />
              <line x1="100" y1="100" x2="100" y2="50" class="bond" />
              <line x1="220" y1="100" x2="220" y2="160" class="bond" />
            </g>
            <g class="atoms">
              <circle cx="40" cy="100" r="18" class="atom" id="c1" data-id="c1" />
              <circle cx="100" cy="100" r="18" class="atom" id="c2" data-id="c2" />
              <circle cx="160" cy="100" r="18" class="atom" id="c3" data-id="c3" />
              <circle cx="220" cy="100" r="18" class="atom" id="c4" data-id="c4" />
              <circle cx="280" cy="100" r="18" class="atom" id="c5" data-id="c5" />
              <circle cx="100" cy="50" r="18" class="atom" id="c6" data-id="c6" />
              <circle cx="220" cy="160" r="18" class="atom" id="c7" data-id="c7" />
            </g>
          </svg>`,
          correctChain: ["c1", "c2", "c3", "c4", "c5"],
          hint: "üí° D√ºz zincir 5 karbonludur ve en uzundur."
        },
        {
          type: "chain_selection",
          question: "Bu yapƒ±da en uzun zincir hangisidir?",
          moleculeSVG: `<svg viewBox="0 0 400 200" style="background:rgba(0,0,0,0.2); border-radius:12px;">
             <g class="bonds">
               <line x1="80" y1="50" x2="140" y2="50" class="bond" />
               <line x1="140" y1="50" x2="200" y2="50" class="bond" />
               <line x1="200" y1="50" x2="200" y2="110" class="bond" />
               <line x1="200" y1="110" x2="140" y2="110" class="bond" />
               <line x1="140" y1="110" x2="80" y2="110" class="bond" />
               <line x1="80" y1="110" x2="80" y2="170" class="bond" />
             </g>
             <g class="atoms">
               <circle cx="80" cy="50" r="18" class="atom" id="c1" data-id="c1" />
               <circle cx="140" cy="50" r="18" class="atom" id="c2" data-id="c2" />
               <circle cx="200" cy="50" r="18" class="atom" id="c3" data-id="c3" />
               <circle cx="200" cy="110" r="18" class="atom" id="c4" data-id="c4" />
               <circle cx="140" cy="110" r="18" class="atom" id="c5" data-id="c5" />
               <circle cx="80" cy="110" r="18" class="atom" id="c6" data-id="c6" />
               <circle cx="80" cy="170" r="18" class="atom" id="c7" data-id="c7" />
             </g>
           </svg>`,
          correctChain: ["c1", "c2", "c3", "c4", "c5", "c6", "c7"],
          hint: "üí° Zincir yƒ±lan gibi kƒ±vrƒ±lƒ±yor, takip et (7 karbon)."
        },
        {
          type: "chain_selection",
          question: "Basit bir soru: Bu b√ºtan molek√ºl√ºnde zinciri se√ßin.",
          moleculeSVG: `<svg viewBox="0 0 400 120" style="background:rgba(0,0,0,0.2); border-radius:12px;">
             <g class="bonds">
               <line x1="50" y1="60" x2="150" y2="60" class="bond" />
               <line x1="150" y1="60" x2="250" y2="60" class="bond" />
               <line x1="250" y1="60" x2="350" y2="60" class="bond" />
             </g>
             <g class="atoms">
               <circle cx="50" cy="60" r="20" class="atom" id="c1" data-id="c1" />
               <circle cx="150" cy="60" r="20" class="atom" id="c2" data-id="c2" />
               <circle cx="250" cy="60" r="20" class="atom" id="c3" data-id="c3" />
               <circle cx="350" cy="60" r="20" class="atom" id="c4" data-id="c4" />
             </g>
           </svg>`,
          correctChain: ["c1", "c2", "c3", "c4"],
          hint: "üí° D√ºz √ßizgiyi takip etmen yeterli."
        }
      ],
      interactiveQuestionsStep2: [
        {
          type: "chain_selection",
          question: "2-Metilb√ºtan bile≈üiƒüindeki yan dalƒ± (Metil grubunu) se√ßin.",
          moleculeSVG: `<svg viewBox="0 0 320 200" style="background:rgba(0,0,0,0.2); border-radius:12px;"><g class="bonds"><line x1="60" y1="140" x2="120" y2="140" class="bond"/><line x1="120" y1="140" x2="180" y2="140" class="bond"/><line x1="180" y1="140" x2="240" y2="140" class="bond"/><line x1="120" y1="140" x2="120" y2="80" class="bond"/></g><g class="atoms"><circle cx="60" cy="140" r="18" class="atom" id="c1" data-id="c1"/><circle cx="120" cy="140" r="18" class="atom" id="c2" data-id="c2"/><circle cx="180" cy="140" r="18" class="atom" id="c3" data-id="c3"/><circle cx="240" cy="140" r="18" class="atom" id="c4" data-id="c4"/><circle cx="120" cy="80" r="18" class="atom" id="c5" data-id="c5"/></g></svg>`,
          correctChain: ["c5"],
          hint: "üí° Ana zincirin dƒ±≈üƒ±nda kalan tek karbonlu grup."
        },
        {
          type: "chain_selection",
          question: "3-Etilpentan bile≈üiƒüindeki Etil grubunu se√ßin.",
          moleculeSVG: `<svg viewBox="0 0 400 240" style="background:rgba(0,0,0,0.2); border-radius:12px;"><g class="bonds"><line x1="40" y1="100" x2="100" y2="100" class="bond"/><line x1="100" y1="100" x2="160" y2="100" class="bond"/><line x1="160" y1="100" x2="220" y2="100" class="bond"/><line x1="220" y1="100" x2="280" y2="100" class="bond"/><line x1="160" y1="100" x2="160" y2="160" class="bond"/><line x1="160" y1="160" x2="160" y2="220" class="bond"/></g><g class="atoms"><circle cx="40" cy="100" r="18" class="atom" id="c1" data-id="c1"/><circle cx="100" cy="100" r="18" class="atom" id="c2" data-id="c2"/><circle cx="160" cy="100" r="18" class="atom" id="c3" data-id="c3"/><circle cx="220" cy="100" r="18" class="atom" id="c4" data-id="c4"/><circle cx="280" cy="100" r="18" class="atom" id="c5" data-id="c5"/><circle cx="160" cy="160" r="18" class="atom" id="c6" data-id="c6"/><circle cx="160" cy="220" r="18" class="atom" id="c7" data-id="c7"/></g></svg>`,
          correctChain: ["c6", "c7"],
          hint: "üí° Ana zincire baƒülƒ± 2 karbonlu dalƒ± bulun."
        },
        {
          type: "chain_selection",
          question: "Bu molek√ºldeki T√úM yan dallarƒ± se√ßin (2 tane).",
          moleculeSVG: `<svg viewBox="0 0 300 240" style="background:rgba(0,0,0,0.2); border-radius:12px;"><g class="bonds"><line x1="80" y1="120" x2="150" y2="120" class="bond"/><line x1="150" y1="120" x2="220" y2="120" class="bond"/><line x1="150" y1="120" x2="150" y2="50" class="bond"/><line x1="150" y1="120" x2="150" y2="190" class="bond"/></g><g class="atoms"><circle cx="80" cy="120" r="18" class="atom" id="c1" data-id="c1"/><circle cx="150" cy="120" r="18" class="atom" id="c2" data-id="c2"/><circle cx="220" cy="120" r="18" class="atom" id="c3" data-id="c3"/><circle cx="150" cy="50" r="18" class="atom" id="c4" data-id="c4"/><circle cx="150" cy="190" r="18" class="atom" id="c5" data-id="c5"/></g></svg>`,
          correctChain: ["c4", "c5"],
          hint: "üí° Merkezdeki karbona baƒülƒ± 4 grup var. En uzun zinciri bul, kalanlar yan daldƒ±r."
        },
        {
          type: "chain_selection",
          question: "Bu yapƒ±da ƒ∞ZOPROPƒ∞L yan dalƒ±nƒ± se√ßin.",
          moleculeSVG: `<svg viewBox="0 0 360 220" style="background:rgba(0,0,0,0.2); border-radius:12px;"><g class="bonds"><line x1="40" y1="80" x2="100" y2="80" class="bond"/><line x1="100" y1="80" x2="160" y2="80" class="bond"/><line x1="160" y1="80" x2="220" y2="80" class="bond"/><line x1="220" y1="80" x2="280" y2="80" class="bond"/><line x1="160" y1="80" x2="160" y2="140" class="bond"/><line x1="160" y1="140" x2="120" y2="190" class="bond"/><line x1="160" y1="140" x2="200" y2="190" class="bond"/></g><g class="atoms"><circle cx="40" cy="80" r="18" class="atom" id="c1" data-id="c1"/><circle cx="100" cy="80" r="18" class="atom" id="c2" data-id="c2"/><circle cx="160" cy="80" r="18" class="atom" id="c3" data-id="c3"/><circle cx="220" cy="80" r="18" class="atom" id="c4" data-id="c4"/><circle cx="280" cy="80" r="18" class="atom" id="c5" data-id="c5"/><circle cx="160" cy="140" r="18" class="atom" id="c6" data-id="c6"/><circle cx="120" cy="190" r="18" class="atom" id="c7" data-id="c7"/><circle cx="200" cy="190" r="18" class="atom" id="c8" data-id="c8"/></g></svg>`,
          correctChain: ["c6", "c7", "c8"],
          hint: "üí° 'Y' harfine benzeyen 3 karbonlu grup."
        },
        {
          type: "chain_selection",
          question: "Dikkat: Sadece ETƒ∞L grubunu se√ßin (Metil'i se√ßmeyin).",
          moleculeSVG: `<svg viewBox="0 0 380 220" style="background:rgba(0,0,0,0.2); border-radius:12px;"><g class="bonds"><line x1="40" y1="100" x2="100" y2="100" class="bond"/><line x1="100" y1="100" x2="160" y2="100" class="bond"/><line x1="160" y1="100" x2="220" y2="100" class="bond"/><line x1="220" y1="100" x2="280" y2="100" class="bond"/><line x1="160" y1="100" x2="160" y2="50" class="bond"/><line x1="220" y1="100" x2="220" y2="160" class="bond"/><line x1="220" y1="160" x2="220" y2="210" class="bond"/></g><g class="atoms"><circle cx="40" cy="100" r="18" class="atom" id="c1" data-id="c1"/><circle cx="100" cy="100" r="18" class="atom" id="c2" data-id="c2"/><circle cx="160" cy="100" r="18" class="atom" id="c3" data-id="c3"/><circle cx="220" cy="100" r="18" class="atom" id="c4" data-id="c4"/><circle cx="280" cy="100" r="18" class="atom" id="c5" data-id="c5"/><circle cx="160" cy="50" r="18" class="atom" id="c6" data-id="c6"/><circle cx="220" cy="160" r="18" class="atom" id="c7" data-id="c7"/><circle cx="220" cy="210" r="18" class="atom" id="c8" data-id="c8"/></g></svg>`,
          correctChain: ["c7", "c8"],
          hint: "üí° Etil 2 karbonludur. Metil 1 karbonludur."
        }
      ],
      maxQuestionsPerStep: 10,

      // Completed steps per topic
      progress: {
        alkanlar: [],
        alkenler: [],
        alkinler: [],
        arenler: []
      },

      // Topic definitions
      topics: {
        alkanlar: {
          id: 'alkanlar',
          title: 'Alkanlar',
          subtitle: 'Tek baƒülƒ± hidrokarbonlar',
          locked: false,
          steps: [
            {
              id: 1,
              title: "Ana Zincir Belirleme",
              subtitle: "ƒ∞lk 10 alkan ve yapƒ± tanƒ±ma",
              questions: [
                // --- Karbon Sayƒ±sƒ± Sorularƒ± (1-10) ---
                { question: "Metan ka√ß karbonludur?", choices: [{ id: "a", label: "1" }, { id: "b", label: "2" }, { id: "c", label: "3" }, { id: "d", label: "4" }], answerId: "a", hint: "üí° Met- √∂n eki 1'i temsil eder." },
                { question: "Etan ka√ß karbonludur?", choices: [{ id: "a", label: "1" }, { id: "b", label: "2" }, { id: "c", label: "3" }, { id: "d", label: "4" }], answerId: "b", hint: "üí° Et- √∂n eki 2'yi temsil eder." },
                { question: "Propan ka√ß karbonludur?", choices: [{ id: "a", label: "3" }, { id: "b", label: "4" }, { id: "c", label: "5" }, { id: "d", label: "6" }], answerId: "a", hint: "üí° Prop- √∂n eki 3'√º temsil eder." },
                { question: "B√ºtan ka√ß karbonludur?", choices: [{ id: "a", label: "3" }, { id: "b", label: "4" }, { id: "c", label: "5" }, { id: "d", label: "6" }], answerId: "b", hint: "üí° B√ºt- √∂n eki 4'√º temsil eder." },
                { question: "Pentan ka√ß karbonludur?", choices: [{ id: "a", label: "4" }, { id: "b", label: "5" }, { id: "c", label: "6" }, { id: "d", label: "7" }], answerId: "b", hint: "üí° Pent- = 5" },
                { question: "Hekzan ka√ß karbonludur?", choices: [{ id: "a", label: "5" }, { id: "b", label: "6" }, { id: "c", label: "7" }, { id: "d", label: "8" }], answerId: "b", hint: "üí° Hekz- = 6" },
                { question: "Heptan ka√ß karbonludur?", choices: [{ id: "a", label: "6" }, { id: "b", label: "7" }, { id: "c", label: "8" }, { id: "d", label: "9" }], answerId: "b", hint: "üí° Hept- = 7" },
                { question: "Oktan ka√ß karbonludur?", choices: [{ id: "a", label: "7" }, { id: "b", label: "8" }, { id: "c", label: "9" }, { id: "d", label: "10" }], answerId: "b", hint: "üí° Okt- = 8" },
                { question: "Nonan ka√ß karbonludur?", choices: [{ id: "a", label: "8" }, { id: "b", label: "9" }, { id: "c", label: "10" }, { id: "d", label: "11" }], answerId: "b", hint: "üí° Non- = 9" },
                { question: "Dekan ka√ß karbonludur?", choices: [{ id: "a", label: "9" }, { id: "b", label: "10" }, { id: "c", label: "11" }, { id: "d", label: "12" }], answerId: "b", hint: "üí° Dek- = 10" },

                // --- ƒ∞sim Sorularƒ± (1-10) ---
                { question: "1 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Metan" }, { id: "b", label: "Etan" }, { id: "c", label: "Propan" }, { id: "d", label: "B√ºtan" }], answerId: "a", hint: "üí° En basit alkan: Metan" },
                { question: "2 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Metan" }, { id: "b", label: "Etan" }, { id: "c", label: "Propan" }, { id: "d", label: "B√ºtan" }], answerId: "b", hint: "üí° C2H6 = Etan" },
                { question: "3 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Etan" }, { id: "b", label: "Propan" }, { id: "c", label: "B√ºtan" }, { id: "d", label: "Pentan" }], answerId: "b", hint: "üí° LPG'nin ana bile≈üeni: Propan" },
                { question: "4 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Propan" }, { id: "b", label: "B√ºtan" }, { id: "c", label: "Pentan" }, { id: "d", label: "Hekzan" }], answerId: "b", hint: "üí° √áakmak gazƒ±: B√ºtan" },
                { question: "5 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "B√ºtan" }, { id: "b", label: "Pentan" }, { id: "c", label: "Hekzan" }, { id: "d", label: "Heptan" }], answerId: "b", hint: "üí° 5 k√∂≈üe = Pentagon -> Pentan" },
                { question: "6 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Pentan" }, { id: "b", label: "Hekzan" }, { id: "c", label: "Heptan" }, { id: "d", label: "Oktan" }], answerId: "b", hint: "üí° 6 = Hekza" },
                { question: "7 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Hekzan" }, { id: "b", label: "Heptan" }, { id: "c", label: "Oktan" }, { id: "d", label: "Nonan" }], answerId: "b", hint: "üí° 7 = Hepta" },
                { question: "8 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Heptan" }, { id: "b", label: "Oktan" }, { id: "c", label: "Nonan" }, { id: "d", label: "Dekan" }], answerId: "b", hint: "üí° 8 = Okta (Oktopus)" },
                { question: "9 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Oktan" }, { id: "b", label: "Nonan" }, { id: "c", label: "Dekan" }, { id: "d", label: "Undekan" }], answerId: "b", hint: "üí° 9 = Nona" },
                { question: "10 karbonlu alkanƒ±n adƒ± nedir?", choices: [{ id: "a", label: "Nonan" }, { id: "b", label: "Dekan" }, { id: "c", label: "Undekan" }, { id: "d", label: "Dodekan" }], answerId: "b", hint: "üí° 10 = Deka" },

                // --- Form√ºl Sorularƒ± (CnH2n+2) ---
                { question: "C3H8 bile≈üiƒüinin adƒ± nedir?", choices: [{ id: "a", label: "Etan" }, { id: "b", label: "Propan" }, { id: "c", label: "B√ºtan" }, { id: "d", label: "Pentan" }], answerId: "b", hint: "üí° n=3" },
                { question: "C5H12 bile≈üiƒüinin adƒ± nedir?", choices: [{ id: "a", label: "B√ºtan" }, { id: "b", label: "Pentan" }, { id: "c", label: "Hekzan" }, { id: "d", label: "Heptan" }], answerId: "b", hint: "üí° n=5" },
                { question: "Hangi form√ºl bir alkana aittir?", choices: [{ id: "a", label: "C4H8" }, { id: "b", label: "C4H10" }, { id: "c", label: "C4H6" }, { id: "d", label: "C4H12" }], answerId: "b", hint: "üí° Alkanlar CnH2n+2 form√ºl√ºne uyar (4x2+2=10)." },
                { question: "Oktan'ƒ±n kimyasal form√ºl√º nedir?", choices: [{ id: "a", label: "C8H16" }, { id: "b", label: "C8H18" }, { id: "c", label: "C8H14" }, { id: "d", label: "C8H20" }], answerId: "b", hint: "üí° 8x2 + 2 = 18" },

                // --- Doƒüru/Yanlƒ±≈ü Sorularƒ± ---
                { question: "Alkanlar doymu≈ü hidrokarbonlardƒ±r.", choices: [{ id: "t", label: "Doƒüru" }, { id: "f", label: "Yanlƒ±≈ü" }], answerId: "t", hint: "üí° Sadece tek baƒü i√ßerirler." },
                { question: "Metan en basit alkandƒ±r.", choices: [{ id: "t", label: "Doƒüru" }, { id: "f", label: "Yanlƒ±≈ü" }], answerId: "t", hint: "üí° Tek karbonludur." },
                { question: "Alkanlarda pi baƒüƒ± bulunur.", choices: [{ id: "t", label: "Doƒüru" }, { id: "f", label: "Yanlƒ±≈ü" }], answerId: "f", hint: "üí° Pi baƒüƒ± ikili ve √º√ßl√º baƒülarda olur. Alkanlarda sadece sigma baƒüƒ± vardƒ±r." },
                { question: "T√ºm karbon atomlarƒ± sp¬≥ hibritle≈ümesi yapmƒ±≈ütƒ±r.", choices: [{ id: "t", label: "Doƒüru" }, { id: "f", label: "Yanlƒ±≈ü" }], answerId: "t", hint: "üí° Alkanlarda karbonlar 4 tekli baƒü yapar." },

                // --- G√∂rsel Sorular (Sadece D√ºz Zincirler) ---
                {
                  question: "Bu g√∂rseldeki yapƒ± hangisidir?",
                  molecule: `<svg width="200" height="60" viewBox="0 0 200 60" style="margin:0 auto;display:block"><path d="M20,40 L50,20 L80,40 L110,20 L140,40" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/></svg>`,
                  choices: [{ id: "a", label: "Propan" }, { id: "b", label: "B√ºtan" }, { id: "c", label: "Pentan" }, { id: "d", label: "Hekzan" }],
                  answerId: "c",
                  hint: "üí° K√∂≈üeleri say: 5 k√∂≈üe/u√ß = Pentan"
                },
                {
                  question: "Hangi yapƒ± Hekzan'ƒ± (6 karbon) temsil eder?",
                  choices: [
                    { id: "a", label: "4", molecule: `<svg width="80" height="30" viewBox="0 0 100 40"><path d="M10,30 L30,10 L50,30 L70,10" fill="none" stroke="white" stroke-width="3"/></svg>` },
                    { id: "b", label: "6", molecule: `<svg width="80" height="30" viewBox="0 0 140 40"><path d="M10,30 L30,10 L50,30 L70,10 L90,30 L110,10" fill="none" stroke="white" stroke-width="3"/></svg>` },
                    { id: "c", label: "5", molecule: `<svg width="80" height="30" viewBox="0 0 120 40"><path d="M10,30 L30,10 L50,30 L70,10 L90,30" fill="none" stroke="white" stroke-width="3"/></svg>` },
                    { id: "d", label: "3", molecule: `<svg width="80" height="30" viewBox="0 0 80 40"><path d="M10,30 L30,10 L50,30" fill="none" stroke="white" stroke-width="3"/></svg>` }
                  ],
                  answerId: "b",
                  hint: "üí° 6 k√∂≈üe/u√ß i√ßeren ≈üƒ±kkƒ± bul."
                }
              ]
            },
            {
              id: 2,
              title: "Yan Dal (Alkil Gruplarƒ±)",
              subtitle: "Metil, etil, propil ve √∂n ekler",
              questions: [
                {
                  question: "Tek karbonlu yan dal grubunun adƒ± nedir?",
                  choices: [
                    { id: "a", label: "Etil" },
                    { id: "b", label: "Metil" },
                    { id: "c", label: "Propil" }
                  ],
                  answerId: "b",
                  hint: "üí° Met- √∂n eki 1 karbonu temsil eder (metan ‚Üí metil)."
                },
                {
                  question: "-CH‚ÇÇCH‚ÇÉ grubunun adƒ± nedir?",
                  choices: [
                    { id: "a", label: "Metil" },
                    { id: "b", label: "Etil" },
                    { id: "c", label: "Propil" }
                  ],
                  answerId: "b",
                  hint: "üí° 2 karbonlu grup = Et- (etan ‚Üí etil)."
                },
                {
                  question: "'mono-' √∂n eki ne anlama gelir?",
                  choices: [
                    { id: "a", label: "1 tane" },
                    { id: "b", label: "2 tane" },
                    { id: "c", label: "3 tane" }
                  ],
                  answerId: "a",
                  hint: "üí° mono- = tek, bir adet (genellikle yazƒ±lmaz)"
                },
                {
                  question: "'di-' √∂n eki ne anlama gelir?",
                  choices: [
                    { id: "a", label: "1 tane" },
                    { id: "b", label: "2 tane" },
                    { id: "c", label: "4 tane" }
                  ],
                  answerId: "b",
                  hint: "üí° di- = 2 (dimetil = 2 metil)"
                },
                {
                  question: "'tri-' √∂n eki ne anlama gelir?",
                  choices: [
                    { id: "a", label: "2 tane" },
                    { id: "b", label: "3 tane" },
                    { id: "c", label: "4 tane" }
                  ],
                  answerId: "b",
                  hint: "üí° tri- = 3 (trimetil = 3 metil)"
                },
                {
                  question: "'tetra-' √∂n eki ne anlama gelir?",
                  choices: [
                    { id: "a", label: "3 tane" },
                    { id: "b", label: "4 tane" },
                    { id: "c", label: "5 tane" }
                  ],
                  answerId: "b",
                  hint: "üí° tetra- = 4 (karbontetraklor√ºr gibi)"
                },
                {
                  question: "3 karbonlu yan dal grubunun adƒ± nedir?",
                  choices: [
                    { id: "a", label: "Metil" },
                    { id: "b", label: "Etil" },
                    { id: "c", label: "Propil" }
                  ],
                  answerId: "c",
                  hint: "üí° 3 karbon = prop- (propan ‚Üí propil)"
                },
                {
                  question: "Aynƒ± daldan 2 tane varsa hangi √∂n ek kullanƒ±lƒ±r?",
                  choices: [
                    { id: "a", label: "mono-" },
                    { id: "b", label: "di-" },
                    { id: "c", label: "tri-" }
                  ],
                  answerId: "b",
                  hint: "üí° di- = 2, tri- = 3, tetra- = 4"
                }
              ]
            },
            {
              id: 3,
              title: "Numaralandƒ±rma",
              subtitle: "En k√º√ß√ºk numara kuralƒ±",
              questions: [
                {
                  question: "Zinciri numaralandƒ±rƒ±rken dallara hangi numaralar verilmelidir?",
                  choices: [
                    { id: "a", label: "En b√ºy√ºk numaralar" },
                    { id: "b", label: "En k√º√ß√ºk numaralar" },
                    { id: "c", label: "Ortadaki numaralar" }
                  ],
                  answerId: "b",
                  hint: "üí° IUPAC'a g√∂re yan gruplar m√ºmk√ºn olan en k√º√ß√ºk numaralarƒ± almalƒ±dƒ±r."
                },
                {
                  question: "5 karbonlu zincirde 2. ve 4. karbonda metil varsa, doƒüru numaralandƒ±rma nasƒ±l olur?",
                  choices: [
                    { id: "a", label: "2,4-dimetil (soldan)" },
                    { id: "b", label: "2,4-dimetil (saƒüdan)" },
                    { id: "c", label: "ƒ∞kisi de doƒüru" }
                  ],
                  answerId: "c",
                  hint: "üí° 2+4 = 6, saƒüdan da 2+4 = 6. E≈üit olduƒüunda her ikisi de kabul edilir."
                },
                {
                  question: "Numaralandƒ±rmaya hangi u√ßtan ba≈ülanƒ±r?",
                  choices: [
                    { id: "a", label: "Her zaman soldan" },
                    { id: "b", label: "Dala en yakƒ±n u√ßtan" },
                    { id: "c", label: "Her zaman saƒüdan" }
                  ],
                  answerId: "b",
                  hint: "üí° Yan gruplara en k√º√ß√ºk numarayƒ± verecek u√ßtan ba≈ülanƒ±r."
                },
                {
                  question: "6 karbonlu zincirde 2. karbonda dal varsa, ka√ßƒ±ncƒ± karbondan ba≈ülamalƒ±yƒ±z?",
                  choices: [
                    { id: "a", label: "Dalƒ±n yakƒ±nƒ±ndaki u√ßtan (2 vermek i√ßin)" },
                    { id: "b", label: "Dalƒ±n uzaƒüƒ±ndaki u√ßtan (5 vermek i√ßin)" },
                    { id: "c", label: "Fark etmez" }
                  ],
                  answerId: "a",
                  hint: "üí° 2 < 5 olduƒüundan dalƒ±n yakƒ±nƒ±ndan ba≈ülarƒ±z."
                },
                {
                  question: "ƒ∞ki dal e≈üit uzaklƒ±ktaysa numaralandƒ±rma nasƒ±l yapƒ±lƒ±r?",
                  choices: [
                    { id: "a", label: "B√ºy√ºk dal k√º√ß√ºk numara alƒ±r" },
                    { id: "b", label: "Alfabetik √∂ncelikli dal k√º√ß√ºk numara alƒ±r" },
                    { id: "c", label: "Rastgele se√ßilir" }
                  ],
                  answerId: "b",
                  hint: "üí° E≈üit uzaklƒ±kta ise alfabetik √∂ncelik kuralƒ± devreye girer."
                },
                {
                  question: "3-metilheksan bile≈üiƒüinde ana zincir ka√ß karbonludur?",
                  choices: [
                    { id: "a", label: "3" },
                    { id: "b", label: "6" },
                    { id: "c", label: "7" }
                  ],
                  answerId: "b",
                  hint: "üí° 'heksan' 6 karbonlu anlamƒ±na gelir."
                },
                {
                  question: "2,3-dimetilb√ºtan'da toplamda ka√ß karbon atomu var?",
                  choices: [
                    { id: "a", label: "4" },
                    { id: "b", label: "6" },
                    { id: "c", label: "8" }
                  ],
                  answerId: "b",
                  hint: "üí° B√ºtan (4) + 2 metil (2) = 6 karbon"
                },
                {
                  question: "Numaralandƒ±rma sonucu '2,2-dimetil' yazƒ±yorsa ne anlama gelir?",
                  choices: [
                    { id: "a", label: "ƒ∞ki farklƒ± karbonda birer metil" },
                    { id: "b", label: "Aynƒ± karbonda iki metil" },
                    { id: "c", label: "Ardƒ±≈üƒ±k karbonlarda metil" }
                  ],
                  answerId: "b",
                  hint: "üí° 2,2 = aynƒ± 2. karbonda 2 tane metil grubu var."
                },
                {
                  question: "Hangisi doƒüru numaralandƒ±rmadƒ±r? (7 karbonlu zincir, 3. karbonda etil)",
                  choices: [
                    { id: "a", label: "3-etilheptan" },
                    { id: "b", label: "5-etilheptan" },
                    { id: "c", label: "ƒ∞kisi de doƒüru" }
                  ],
                  answerId: "a",
                  hint: "üí° 3 < 5 olduƒüundan 3-etilheptan doƒürudur."
                },
                {
                  question: "Numaralandƒ±rmada 'en k√º√ß√ºk toplam' kuralƒ± ne zaman uygulanƒ±r?",
                  choices: [
                    { id: "a", label: "Tek dal olduƒüunda" },
                    { id: "b", label: "Birden fazla dal olduƒüunda" },
                    { id: "c", label: "Hi√ßbir zaman" }
                  ],
                  answerId: "b",
                  hint: "üí° Birden fazla dal varsa, toplamƒ± en k√º√ß√ºk yapan numaralandƒ±rma se√ßilir."
                },
                {
                  question: "2,2-dimetilpropan (Neopentan) bile≈üiƒüinde numaralandƒ±rma i√ßin en uzun zincir ka√ß karbondur?",
                  choices: [
                    { id: "a", label: "3" },
                    { id: "b", label: "4" },
                    { id: "c", label: "5" }
                  ],
                  answerId: "a",
                  hint: "üí° Merkez karbona baƒülƒ± 4 metil vardƒ±r, en uzun zincir 3 karbondur (Propan)."
                },
                {
                  question: "A≈üaƒüƒ±daki bile≈üikte (ƒ∞zopentan) numaralandƒ±rma hangi u√ßtan ba≈ülar?",
                  molecule: `<svg width="100%" height="150" viewBox="0 0 300 120" style="background:#2A2342; border-radius:12px; margin-bottom:12px;">
                    <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                      <line x1="50" y1="80" x2="110" y2="80" />
                      <line x1="110" y1="80" x2="170" y2="80" />
                      <line x1="170" y1="80" x2="230" y2="80" />
                      <line x1="110" y1="80" x2="110" y2="35" />
                    </g>
                    <g class="atoms">
                      <circle cx="50" cy="80" r="14" class="atom" fill="#4B3F72" stroke="white" stroke-width="2" />
                      <circle cx="110" cy="80" r="14" class="atom" fill="#4B3F72" stroke="white" stroke-width="2" />
                      <circle cx="170" cy="80" r="14" class="atom" fill="#4B3F72" stroke="white" stroke-width="2" />
                      <circle cx="230" cy="80" r="14" class="atom" fill="#4B3F72" stroke="white" stroke-width="2" />
                      <circle cx="110" cy="35" r="12" class="atom sub" fill="#FF6B6B" />
                    </g>
                   </svg>`,
                  choices: [
                    { id: "a", label: "Metil grubunun yakƒ±n olduƒüu u√ßtan (Sol)" },
                    { id: "b", label: "D√ºz zincirin sonundan (Saƒü)" },
                    { id: "c", label: "Fark etmez" }
                  ],
                  answerId: "a",
                  hint: "üí° Soldan ba≈ülarsak dal 2. karbona denk gelir (2-metilb√ºtan)."
                },
                {
                  question: "3,3-dimetilpentan bile≈üiƒüinde dallanmalar ka√ßƒ±ncƒ± karbondadƒ±r?",
                  choices: [
                    { id: "a", label: "2" },
                    { id: "b", label: "3" },
                    { id: "c", label: "4" }
                  ],
                  answerId: "b",
                  hint: "üí° Simetrik yapƒ± olduƒüu i√ßin her iki u√ßtan da 3. karbonda olur."
                }
              ]
            },
            {
              id: 4,
              title: "Adlandƒ±rma Kurallarƒ± ve Uygulamalarƒ±",
              subtitle: "Alfabetik sƒ±ralama ve ƒ∞sim Olu≈üturma",
              questions: [
                {
                  question: "etil ve metil gruplarƒ± varsa hangisi √∂nce yazƒ±lƒ±r?",
                  choices: [
                    { id: "a", label: "metil" },
                    { id: "b", label: "etil" },
                    { id: "c", label: "Fark etmez" }
                  ],
                  answerId: "b",
                  hint: "üí° Alfabetik sƒ±raya g√∂re: E harfi M'den √∂nce gelir."
                },
                {
                  question: "di-, tri- gibi √∂n ekler alfabetik sƒ±ralamaya dahil edilir mi?",
                  choices: [
                    { id: "a", label: "Evet, dahil edilir" },
                    { id: "b", label: "Hayƒ±r, edilmez" },
                    { id: "c", label: "Sadece di- dahil" }
                  ],
                  answerId: "b",
                },
                // --- NEW USER REQUESTED MCQ ---
                {
                  question: "A≈üaƒüƒ±daki bile≈üiƒüin doƒüru adƒ± hangisidir?",
                  molecule: "<div style='font-size:18px; font-weight:bold; letter-spacing:1px; text-align:center; padding:10px;'>CH‚ÇÉ‚ÄìCH(CH‚ÇÉ)‚ÄìCH(CH‚ÇÉ)‚ÄìCH‚ÇÉ</div>",
                  choices: [
                    { id: "a", label: "2,3-dimetilbutan" },
                    { id: "b", label: "2,2-dimetilbutan" },
                    { id: "c", label: "3,3-dimetilbutan" },
                    { id: "d", label: "dimetilbutan" }
                  ],
                  answerId: "a",
                  hint: "üí° Ana zincir 4 C, yan dallar 2. ve 3. karbonlarda."
                },

                // --- NAME BUILDER QUESTIONS ---
                {
                  type: "name_builder",
                  question: "7 karbonlu zincir. 3. Karbon etil dalƒ±, 5. Karbon metil dalƒ± var.Buna g√∂re bile≈üik adƒ± nedir?",
                  tokens: ["3", "5", "-", "etil", "metil", "heptan"],
                  correctSequence: ["3", "-", "etil", "-", "5", "-", "metil", "heptan"],
                  hint: "üí° U√ßlara e≈üit uzaklƒ±kta olduklarƒ± i√ßin alfabetik √∂nceliƒüi olan (Etil) k√º√ß√ºk numarayƒ± alƒ±r."
                },
                {
                  type: "name_builder",
                  question: "4 karbonlu zincir, 2. karbonda Metil var.",
                  tokens: ["2", "3", "-", "metil", "etil", "butan"],
                  correctSequence: ["2", "-", "metil", "butan"],
                  hint: "üí° Tek yan dal varsa: numara + tire + grup + ana zincir."
                },
                {
                  type: "name_builder",
                  question: "6 karbonlu zincir, 3. karbonda Metil var.",
                  tokens: ["3", "2", "-", "metil", "propil", "heksan"],
                  correctSequence: ["3", "-", "metil", "heksan"],
                  hint: "üí° Ana zincir heksan, yan dal metil."
                },
                {
                  type: "name_builder",
                  question: "3 karbonlu zincir. 2. karbonda iki tane Metil grubu baƒülƒ±.",
                  tokens: ["2", "3", ",", "-", "di", "tri", "metil", "propan"],
                  correctSequence: ["2", ",", "2", "-", "di", "metil", "propan"],
                  hint: "üí° Aynƒ± gruptan 2 tane varsa: 2,2-dimetil..."
                },
                {
                  type: "name_builder",
                  question: "4 karbonlu zincir. 2. ve 3. karbonlarda birer Metil grubu var.",
                  tokens: ["2", "3", "1", ",", "-", "di", "tri", "metil", "etil", "butan"],
                  correctSequence: ["2", ",", "3", "-", "di", "metil", "butan"],
                  hint: "üí° 2 ve 3 konumlarƒ±nda iki metil: 2,3-dimetilbutan."
                },
                {
                  type: "name_builder",
                  question: "7 karbonlu zincir. 4. karbonda Etil, 2. karbonda Metil var.",
                  tokens: ["2", "4", "-", "-", "-", "metil", "etil", "heptan"],
                  correctSequence: ["4", "-", "etil", "-", "2", "-", "metil", "heptan"],
                  hint: "üí° Alfabetik: etil √∂nce, metil sonra."
                },
                {
                  type: "name_builder",
                  question: "6 karbonlu zincir. 3. karbonda Propil grubu var.",
                  tokens: ["3", "2", "-", "propil", "metil", "heksan"],
                  correctSequence: ["3", "-", "propil", "heksan"],
                  hint: "üí° 3. karbonda propil yan dalƒ± var."
                },
                {
                  type: "name_builder",
                  question: "4 karbonlu zincir, 2. karbonda Etil grubu baƒülƒ±.",
                  tokens: ["2", "1", "-", "etil", "metil", "butan"],
                  correctSequence: ["2", "-", "etil", "butan"],
                  hint: "üí° 2. karbonda etil yan dalƒ±."
                },
                {
                  type: "name_builder",
                  question: "6 karbonlu zincir. 3. karbonda hem Etil hem de Metil grubu var.",
                  tokens: ["3", "2", "-", "-", "-", "metil", "etil", "heksan"],
                  correctSequence: ["3", "-", "etil", "-", "3", "-", "metil", "heksan"],
                  hint: "üí° Aynƒ± numara iki kez yazƒ±lƒ±r: 3-etil-3-metil... (alfabetik: etil √∂nce)."
                },
                {
                  type: "name_builder",
                  question: "6 karbonlu zincir. 2. ve 4. karbonlarda birer Metil var.",
                  tokens: ["2", "4", "3", ",", "-", "di", "tri", "metil", "heksan"],
                  correctSequence: ["2", ",", "4", "-", "di", "metil", "heksan"],
                  hint: "üí° 2 ve 4 konumlarƒ±nda iki metil: 2,4-dimetilheksan."
                }
              ]
            },
            {
              id: 5,
              title: "IUPAC Adlandƒ±rma",
              subtitle: "Tam ismi olu≈ütur",
              questions: [
                {
                  question: "2-metilpropan i√ßin doƒüru yapƒ± hangisidir?",
                  molecule: `<div style="display:flex;gap:20px;justify-content:center;flex-wrap:wrap;">
                    <div style="text-align:center;padding:10px;">A)<br>CH‚ÇÉ‚ÄîCH(CH‚ÇÉ)‚ÄîCH‚ÇÉ</div>
                    <div style="text-align:center;padding:10px;">B)<br>CH‚ÇÉ‚ÄîCH‚ÇÇ‚ÄîCH‚ÇÇ‚ÄîCH‚ÇÉ</div>
                  </div>`,
                  choices: [
                    { id: "a", label: "A yapƒ±sƒ±" },
                    { id: "b", label: "B yapƒ±sƒ±" }
                  ],
                  answerId: "a",
                  hint: "üí° 2-metilpropan = 3 karbonlu ana zincir + 2. karbonda metil grubu"
                },
                {
                  question: "Ana zinciri 6 karbon, 3. Karbonda etil, 4. Karbonda metil var. Bile≈üik adƒ± nedir?",
                  choices: [
                    { id: "a", label: "3-etil-4-metilheksan" },
                    { id: "b", label: "4-etil-3-metilheksan" },
                    { id: "c", label: "3-metil-4-etilheksan" }
                  ],
                  answerId: "a",
                  hint: "üí° Dallar u√ßlara e≈üit uzaklƒ±kta (3,4). E≈üitlik durumunda ALFABETƒ∞K √∂nceliƒüi olan (Etil) k√º√ß√ºk numarayƒ± alƒ±r."
                },
                {
                  question: "2,2-dimetilb√ºtan adƒ±ndaki '2,2' ne anlama gelir?",
                  choices: [
                    { id: "a", label: "2 tane metil var" },
                    { id: "b", label: "2. karbonda 2 metil var" },
                    { id: "c", label: "2. ve 2. karbon (hata)" }
                  ],
                  answerId: "b",
                  hint: "üí° Aynƒ± karbona baƒülƒ± birden fazla grup olabilir: 2,2 = 2. karbonda 2 tane"
                },
                // --- NEW VISUAL QUESTIONS ---
                {
                  question: "A≈üaƒüƒ±daki bile≈üiƒüin IUPAC adƒ±nƒ± se√ßiniz.",
                  molecule: `<svg width="100%" height="160" viewBox="0 0 250 120" style="background:#2A2342; border-radius:12px; margin-bottom:10px;">
                    <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                      <line x1="50" y1="60" x2="100" y2="60" />
                      <line x1="100" y1="60" x2="150" y2="60" />
                      <line x1="150" y1="60" x2="200" y2="60" />
                      <line x1="100" y1="60" x2="100" y2="20" />
                      <line x1="100" y1="60" x2="100" y2="100" />
                    </g>
                    <g class="atoms">
                      <circle cx="50" cy="60" r="14" class="atom" fill="#4B3F72" stroke="white" stroke-width="2" />
                      <circle cx="100" cy="60" r="14" class="atom" fill="#4B3F72" stroke="white" stroke-width="2" />
                      <circle cx="150" cy="60" r="14" class="atom" fill="#4B3F72" stroke="white" stroke-width="2" />
                      <circle cx="200" cy="60" r="14" class="atom" fill="#4B3F72" stroke="white" stroke-width="2" />
                      <circle cx="100" cy="20" r="12" class="atom sub" fill="#FF6B6B" />
                      <circle cx="100" cy="100" r="12" class="atom sub" fill="#FF6B6B" />
                    </g>
                  </svg>`,
                  choices: [
                    { id: "a", label: "2,2-dimetilb√ºtan" },
                    { id: "b", label: "2-etil-2-metilpropan" },
                    { id: "c", label: "3,3-dimetilb√ºtan" }
                  ],
                  answerId: "a",
                  hint: "üí° En uzun zincir 4 karbonlu (b√ºtan). 2. karbonda iki metil grubu var."
                },
                {
                  question: "A≈üaƒüƒ±daki bile≈üiƒüin doƒüru IUPAC adƒ± nedir? (Dikkat!)",
                  molecule: `<svg width="100%" height="180" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px; margin-bottom:10px;">
                     <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                       <!-- Horizontal part -->
                       <line x1="50" y1="100" x2="100" y2="100" />
                       <line x1="100" y1="100" x2="150" y2="100" />
                       <line x1="150" y1="100" x2="200" y2="100" />
                       <line x1="200" y1="100" x2="250" y2="100" />
                       
                       <!-- Branch going UP and RIGHT (Ethyl expanding chain) -->
                       <line x1="100" y1="100" x2="100" y2="50" />
                       <line x1="100" y1="50" x2="140" y2="20" />
                     </g>
                     <g class="atoms">
                       <circle cx="50" cy="100" r="12" class="atom" />
                       <circle cx="100" cy="100" r="12" class="atom" />
                       <circle cx="150" cy="100" r="12" class="atom" />
                       <circle cx="200" cy="100" r="12" class="atom" />
                       <circle cx="250" cy="100" r="12" class="atom" />
                       
                       <circle cx="100" cy="50" r="12" class="atom" fill="#FF9F43" />
                       <circle cx="140" cy="20" r="12" class="atom" fill="#FF9F43" />
                     </g>

                  </svg>`,
                  choices: [
                    { id: "a", label: "2-etilpentan" },
                    { id: "b", label: "3-metilheksan" },
                    { id: "c", label: "3-etilheksan" }
                  ],
                  answerId: "b",
                  hint: "üí° 'Etil' dalƒ± zinciri uzatƒ±r! En uzun zincir yukarƒ± doƒüru kƒ±vrƒ±lƒ±r (6 karbon)."
                },
                // --- NEW COMPREHENSIVE APPLICATION QUESTIONS (6-10) ---
                // Q6: 3-metilheksan
                {
                  type: 'comprehensive',
                  stage: 0,
                  question: "Bile≈üiƒüi analiz ediniz: Ana zinciri se√ß, numaralandƒ±r ve adlandƒ±r.",
                  hint: "üí° √ñnce en uzun karbon zincirini bulmalƒ±sƒ±n.",
                  moleculeSVG: `<svg width="100%" height="180" viewBox="0 0 350 150" style="background:#2A2342; border-radius:12px;">
                    <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                       <line x1="50" y1="100" x2="100" y2="100" />
                       <line x1="100" y1="100" x2="150" y2="100" />
                       <line x1="150" y1="100" x2="200" y2="100" />
                       <line x1="200" y1="100" x2="250" y2="100" />
                       <line x1="250" y1="100" x2="300" y2="100" />
                       <line x1="150" y1="100" x2="150" y2="50" />
                    </g>
                    <g class="atoms">
                       <circle cx="50" cy="100" r="12" class="atom" data-id="c1" />
                       <circle cx="100" cy="100" r="12" class="atom" data-id="c2" />
                       <circle cx="150" cy="100" r="12" class="atom" data-id="c3" />
                       <circle cx="200" cy="100" r="12" class="atom" data-id="c4" />
                       <circle cx="250" cy="100" r="12" class="atom" data-id="c5" />
                       <circle cx="300" cy="100" r="12" class="atom" data-id="c6" />
                       <circle cx="150" cy="50" r="12" class="atom sub" fill="#FF9F43" />
                    </g>
                  </svg>`,
                  stages: [
                    { correctChain: ["c1", "c2", "c3", "c4", "c5", "c6"] },
                    {
                      correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5, c6: 6 },
                      userNumbering: {}
                    },
                    {
                      tokens: ["3-", "4-", "metil", "etil", "heksan", "pentan"],
                      correctSequence: ["3-", "metil", "heksan"],
                      userSequence: []
                    }
                  ]
                },
                // Q7: 3-etilpentan
                {
                  type: 'comprehensive',
                  stage: 0,
                  question: "Bile≈üiƒüi analiz ediniz.",
                  hint: "üí° En uzun zincir 5 karbonlu.",
                  moleculeSVG: `<svg width="100%" height="180" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
                    <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                       <line x1="50" y1="100" x2="100" y2="100" />
                       <line x1="100" y1="100" x2="150" y2="100" />
                       <line x1="150" y1="100" x2="200" y2="100" />
                       <line x1="200" y1="100" x2="250" y2="100" />
                       <line x1="150" y1="100" x2="150" y2="50" />
                       <line x1="150" y1="50" x2="150" y2="20" />
                    </g>
                    <g class="atoms">
                       <circle cx="50" cy="100" r="12" class="atom" data-id="c1" />
                       <circle cx="100" cy="100" r="12" class="atom" data-id="c2" />
                       <circle cx="150" cy="100" r="12" class="atom" data-id="c3" />
                       <circle cx="200" cy="100" r="12" class="atom" data-id="c4" />
                       <circle cx="250" cy="100" r="12" class="atom" data-id="c5" />
                       <circle cx="150" cy="50" r="12" class="atom sub" fill="#FF6B6B" /> 
                       <circle cx="150" cy="20" r="12" class="atom sub" fill="#FF6B6B" />
                    </g>
                  </svg>`,
                  stages: [
                    { correctChain: ["c1", "c2", "c3", "c4", "c5"] },
                    {
                      correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 },
                      userNumbering: {}
                    },
                    {
                      tokens: ["3-", "2-", "etil", "metil", "pentan", "heksan"],
                      correctSequence: ["3-", "etil", "pentan"],
                      userSequence: []
                    }
                  ]
                },
                // Q8: 2,3-dimetilbutan (Basit ama iki dal)
                {
                  type: 'comprehensive',
                  stage: 0,
                  question: "Bile≈üiƒüi analiz ediniz.",
                  hint: "üí° ƒ∞ki metil grubu var.",
                  moleculeSVG: `<svg width="100%" height="180" viewBox="0 0 250 150" style="background:#2A2342; border-radius:12px;">
                    <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                       <line x1="50" y1="100" x2="100" y2="100" />
                       <line x1="100" y1="100" x2="150" y2="100" />
                       <line x1="150" y1="100" x2="200" y2="100" />
                       <line x1="100" y1="100" x2="100" y2="50" />
                       <line x1="150" y1="100" x2="150" y2="50" />
                    </g>
                    <g class="atoms">
                       <circle cx="50" cy="100" r="12" class="atom" data-id="c1" />
                       <circle cx="100" cy="100" r="12" class="atom" data-id="c2" />
                       <circle cx="150" cy="100" r="12" class="atom" data-id="c3" />
                       <circle cx="200" cy="100" r="12" class="atom" data-id="c4" />
                       <circle cx="100" cy="50" r="12" class="atom sub" fill="#FF9F43" />
                       <circle cx="150" cy="50" r="12" class="atom sub" fill="#FF9F43" />
                    </g>
                  </svg>`,
                  stages: [
                    { correctChain: ["c1", "c2", "c3", "c4"] },
                    {
                      correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4 },
                      userNumbering: {}
                    },
                    {
                      tokens: ["2,3-", "2-", "3-", "dimetil", "metil", "butan", "pentan"],
                      correctSequence: ["2,3-", "dimetil", "butan"],
                      userSequence: []
                    }
                  ]
                },
                // Q9: 3-etil-2-metilpentan
                {
                  type: 'comprehensive',
                  stage: 0,
                  question: "Bile≈üiƒüi analiz ediniz. (Dallanma √∂nceliƒüi)",
                  hint: "üí° Numaralandƒ±rmaya dallanmaya en yakƒ±n u√ßtan ba≈üla.",
                  moleculeSVG: `<svg width="100%" height="200" viewBox="0 0 300 160" style="background:#2A2342; border-radius:12px;">
                    <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                       <line x1="50" y1="100" x2="100" y2="100" />
                       <line x1="100" y1="100" x2="150" y2="100" />
                       <line x1="150" y1="100" x2="200" y2="100" />
                       <line x1="200" y1="100" x2="250" y2="100" />
                       <!-- Branch at C2 (from left) -->
                       <line x1="100" y1="100" x2="100" y2="60" />
                       <!-- Branch at C3 -->
                       <line x1="150" y1="100" x2="150" y2="60" />
                       <line x1="150" y1="60" x2="150" y2="30" />
                    </g>
                    <g class="atoms">
                       <circle cx="50" cy="100" r="12" class="atom" data-id="c1" />
                       <circle cx="100" cy="100" r="12" class="atom" data-id="c2" />
                       <circle cx="150" cy="100" r="12" class="atom" data-id="c3" />
                       <circle cx="200" cy="100" r="12" class="atom" data-id="c4" />
                       <circle cx="250" cy="100" r="12" class="atom" data-id="c5" />
                       
                       <circle cx="100" cy="60" r="12" class="atom sub" fill="#FF9F43" /> <!-- Methyl -->
                       <circle cx="150" cy="60" r="12" class="atom sub" fill="#FF6B6B" /> <!-- Ethyl C1 -->
                       <circle cx="150" cy="30" r="12" class="atom sub" fill="#FF6B6B" /> <!-- Ethyl C2 -->
                    </g>
                  </svg>`,
                  stages: [
                    { correctChain: ["c1", "c2", "c3", "c4", "c5"] },
                    {
                      correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 },
                      userNumbering: {}
                    },
                    {
                      tokens: ["3-", "etil", "-2-", "metil", "pentan", "heksan"],
                      correctSequence: ["3-", "etil", "-2-", "metil", "pentan"],
                      userSequence: []
                    }
                  ]
                },
                // Q10: 2,2,4-trimetilpentan (Zor: ƒ∞ki u√ßta e≈üit uzaklƒ±k)
                {
                  type: 'comprehensive',
                  stage: 0,
                  question: "Bile≈üiƒüi analiz ediniz. (Dallanma yoƒüunluƒüu)",
                  hint: "üí° ƒ∞ki u√ßta da 2. karbonda dal var. Ama solda ƒ∞Kƒ∞ tane var. √áok olan taraf √∂nceliklidir.",
                  moleculeSVG: `<svg width="100%" height="200" viewBox="0 0 300 160" style="background:#2A2342; border-radius:12px;">
                    <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                       <line x1="50" y1="100" x2="100" y2="100" />
                       <line x1="100" y1="100" x2="150" y2="100" />
                       <line x1="150" y1="100" x2="200" y2="100" />
                       <line x1="200" y1="100" x2="250" y2="100" />
                       <!-- Left C2: 2 methyls -->
                       <line x1="100" y1="100" x2="100" y2="60" />
                       <line x1="100" y1="100" x2="100" y2="140" />
                       <!-- Right C4: 1 methyl -->
                       <line x1="200" y1="100" x2="200" y2="60" />
                    </g>
                    <g class="atoms">
                       <circle cx="50" cy="100" r="12" class="atom" data-id="c1" />
                       <circle cx="100" cy="100" r="12" class="atom" data-id="c2" />
                       <circle cx="150" cy="100" r="12" class="atom" data-id="c3" />
                       <circle cx="200" cy="100" r="12" class="atom" data-id="c4" />
                       <circle cx="250" cy="100" r="12" class="atom" data-id="c5" />
                       
                       <circle cx="100" cy="60" r="12" class="atom sub" fill="#FF9F43" /> 
                       <circle cx="100" cy="140" r="12" class="atom sub" fill="#FF9F43" />
                       <circle cx="200" cy="60" r="12" class="atom sub" fill="#FF9F43" />
                    </g>
                  </svg>`,
                  stages: [
                    { correctChain: ["c1", "c2", "c3", "c4", "c5"] },
                    {
                      correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 }, // Left to right (2,2,4 vs 2,4,4)
                      userNumbering: {}
                    },
                    {
                      tokens: ["2,2,4-", "2,4,4-", "3-", "trimetil", "dimetil", "pentan"],
                      correctSequence: ["2,2,4-", "trimetil", "pentan"],
                      userSequence: []
                    }
                  ]
                }
              ]
            }
          ]
        },

        /* // --- Interactive Numbering Question Data ---
        interactiveQuestionsStep3: [
          {
            type: "numbering_interactive",
            question: "A≈üaƒüƒ±daki bile≈üikte ana zinciri doƒüru ≈üekilde numaralandƒ±rƒ±nƒ±z.",
            hint: "üí° Dallanmanƒ±n en yakƒ±n olduƒüu u√ßtan ba≈üla.",
            moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
              <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                <line x1="50" y1="75" x2="100" y2="75" />
                <line x1="100" y1="75" x2="150" y2="75" />
                <line x1="150" y1="75" x2="200" y2="75" />
                <line x1="200" y1="75" x2="250" y2="75" />
                <line x1="100" y1="75" x2="100" y2="35" /> 
              </g>
              <g class="atoms">
                <circle cx="50" cy="75" r="14" class="atom" data-id="c1" />
                <circle cx="100" cy="75" r="14" class="atom" data-id="c2" />
                <circle cx="150" cy="75" r="14" class="atom" data-id="c3" />
                <circle cx="200" cy="75" r="14" class="atom" data-id="c4" />
                <circle cx="250" cy="75" r="14" class="atom" data-id="c5" />
                <circle cx="100" cy="35" r="14" class="atom" data-id="sub1" fill="#FF6B6B" />
              </g>
            </svg>`,
            correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 }, // Left to right because branch at 2
            userNumbering: {}
          },
          {
            type: "numbering_interactive",
            question: "Numaralandƒ±rma kuralƒ±: En k√º√ß√ºk numara!",
            hint: "üí° Saƒüdan ba≈ülarsak dal 2'ye gelir. Soldan ba≈ülarsak 4'e gelir.",
            moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
              <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                <line x1="50" y1="100" x2="100" y2="100" />
                <line x1="100" y1="100" x2="150" y2="100" />
                <line x1="150" y1="100" x2="200" y2="100" />
                <line x1="200" y1="100" x2="250" y2="100" />
                <line x1="200" y1="100" x2="200" y2="60" />
              </g>
              <g class="atoms">
                <circle cx="50" cy="100" r="14" class="atom" data-id="c1" />
                <circle cx="100" cy="100" r="14" class="atom" data-id="c2" />
                <circle cx="150" cy="100" r="14" class="atom" data-id="c3" />
                <circle cx="200" cy="100" r="14" class="atom" data-id="c4" />
                <circle cx="250" cy="100" r="14" class="atom" data-id="c5" />
                <circle cx="200" cy="60" r="14" class="atom" data-id="sub1" fill="#FF6B6B" />
              </g>
            </svg>`,
            correctNumbering: { c5: 1, c4: 2, c3: 3, c2: 4, c1: 5 }, // Right to left
            userNumbering: {}
          },
          {
            type: "numbering_interactive",
            question: "ƒ∞ki u√ßtan da e≈üitse?",
            hint: "üí° Alfabetik √∂ncelik bakarƒ±z ama burada sadece metil var. ƒ∞stediƒüin u√ßtan ba≈üla (simetrik).",
            moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
               <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                 <line x1="50" y1="80" x2="100" y2="80" />
                 <line x1="100" y1="80" x2="150" y2="80" />
                 <line x1="150" y1="80" x2="200" y2="80" />
                 <line x1="200" y1="80" x2="250" y2="80" />
                 <line x1="100" y1="80" x2="100" y2="40" />
                 <line x1="200" y1="80" x2="200" y2="40" />
               </g>
               <g class="atoms">
                 <circle cx="50" cy="80" r="14" class="atom" data-id="c1" />
                 <circle cx="100" cy="80" r="14" class="atom" data-id="c2" />
                 <circle cx="150" cy="80" r="14" class="atom" data-id="c3" />
                 <circle cx="200" cy="80" r="14" class="atom" data-id="c4" />
                 <circle cx="250" cy="80" r="14" class="atom" data-id="c5" />
                 <circle cx="100" cy="40" r="14" class="atom sub" fill="#FF6B6B" />
                 <circle cx="200" cy="40" r="14" class="atom sub" fill="#FF6B6B" />
               </g>
             </svg>`,
            correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 }, // Accepted solution 1
            secondaryCorrect: { c1: 5, c2: 4, c3: 3, c4: 2, c5: 1 }, // Accepted solution 2
            userNumbering: {}
          },
          {
            type: "numbering_interactive",
            question: "3-metilpentan olu≈üturmak i√ßin numaralandƒ±r",
            hint: "üí° 5 karbonlu zincir, 3. karbonda dal olmalƒ±.",
            moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
              <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                <line x1="50" y1="110" x2="100" y2="80" />
                <line x1="100" y1="80" x2="150" y2="110" />
                <line x1="150" y1="110" x2="200" y2="80" />
                <line x1="200" y1="80" x2="250" y2="110" />
                <line x1="150" y1="110" x2="150" y2="150" />
              </g>
              <g class="atoms">
                <circle cx="50" cy="110" r="14" class="atom" data-id="c1" />
                <circle cx="100" cy="80" r="14" class="atom" data-id="c2" />
                <circle cx="150" cy="110" r="14" class="atom" data-id="c3" />
                <circle cx="200" cy="80" r="14" class="atom" data-id="c4" />
                <circle cx="250" cy="110" r="14" class="atom" data-id="c5" />
                <circle cx="150" cy="150" r="14" class="atom" data-id="sub" fill="#FF6B6B" />
              </g>
             </svg>`,
            correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 },
            secondaryCorrect: { c5: 1, c4: 2, c3: 3, c2: 4, c1: 5 },
            userNumbering: {}
          },
          {
            type: "numbering_interactive",
            question: "Hangisi u√ß? (Terminal karbon)",
            hint: "üí° Zincirin en uzun olmasƒ± i√ßin u√ßtan uca gitmelisin.",
            moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
               <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
                 <line x1="50" y1="75" x2="100" y2="75" />
                 <line x1="100" y1="75" x2="150" y2="75" />
                 <line x1="150" y1="75" x2="200" y2="75" />
               </g>
               <g class="atoms">
                 <circle cx="50" cy="75" r="14" class="atom" data-id="c1" />
                 <circle cx="100" cy="75" r="14" class="atom" data-id="c2" />
                 <circle cx="150" cy="75" r="14" class="atom" data-id="c3" />
                 <circle cx="200" cy="75" r="14" class="atom" data-id="c4" />
               </g>
             </svg>`,
            correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4 },
            secondaryCorrect: { c4: 1, c3: 2, c2: 3, c1: 4 },
            userNumbering: {}
          }
        ], */

        alkenler: {
          id: 'alkenler',
          title: 'Alkenler',
          subtitle: '√áift baƒülƒ± hidrokarbonlar',
          locked: true,
          steps: [
            {
              id: 1,
              title: "√áift Baƒü Tanƒ±ma",
              subtitle: "C=C baƒüƒ±nƒ±n √∂zellikleri",
              questions: [
                {
                  question: "Alkenlerin genel form√ºl√º nedir?",
                  choices: [
                    { id: "a", label: "C‚ÇôH‚ÇÇ‚Çô‚Çä‚ÇÇ" },
                    { id: "b", label: "C‚ÇôH‚ÇÇ‚Çô" },
                    { id: "c", label: "C‚ÇôH‚ÇÇ‚Çô‚Çã‚ÇÇ" }
                  ],
                  answerId: "b",
                  hint: "üí° Alkenler √ßift baƒü i√ßerdiƒüi i√ßin 2 hidrojen eksiktir."
                },
                {
                  question: "En basit alken hangisidir?",
                  choices: [
                    { id: "a", label: "Meten" },
                    { id: "b", label: "Eten (Etilen)" },
                    { id: "c", label: "Propen" }
                  ],
                  answerId: "b",
                  hint: "üí° √áift baƒü i√ßin en az 2 karbon gerekir."
                }
              ]
            },
            {
              id: 2,
              title: "Numaralandƒ±rma",
              subtitle: "√áift baƒüa en yakƒ±n numara",
              questions: [
                {
                  question: "Alkenlerde numaralandƒ±rma hangi kurala g√∂re yapƒ±lƒ±r?",
                  choices: [
                    { id: "a", label: "√áift baƒüa en k√º√ß√ºk numara" },
                    { id: "b", label: "Yan gruba en k√º√ß√ºk numara" },
                    { id: "c", label: "Alfabetik sƒ±raya g√∂re" }
                  ],
                  answerId: "a",
                  hint: "üí° √áift baƒü √∂nceliklidir, en k√º√ß√ºk numarayƒ± alƒ±r."
                }
              ]
            },
            {
              id: 3,
              title: "Cis-Trans ƒ∞zomeri",
              subtitle: "Geometrik izomerler",
              questions: [
                {
                  question: "Cis izomerde gruplar nerededir?",
                  choices: [
                    { id: "a", label: "Aynƒ± tarafta" },
                    { id: "b", label: "Zƒ±t tarafta" },
                    { id: "c", label: "Fark etmez" }
                  ],
                  answerId: "a",
                  hint: "üí° Cis = aynƒ± taraf, Trans = zƒ±t taraf"
                }
              ]
            },
            {
              id: 4,
              title: "Alkil Gruplarƒ±",
              subtitle: "Yan dallar alkenlerde",
              questions: [
                {
                  question: "2-metilpropen'de √ßift baƒü nerededir?",
                  choices: [
                    { id: "a", label: "1. ve 2. karbon arasƒ±" },
                    { id: "b", label: "2. ve 3. karbon arasƒ±" },
                    { id: "c", label: "Belirtilmemi≈ü" }
                  ],
                  answerId: "a",
                  hint: "üí° Numara verilmemi≈üse √ßift baƒü 1'den ba≈ülar."
                }
              ]
            },
            {
              id: 5,
              title: "IUPAC Adlandƒ±rma",
              subtitle: "Alken isimlerini olu≈ütur",
              questions: [
                {
                  question: "CH‚ÇÇ=CH-CH‚ÇÉ bile≈üiƒüinin adƒ± nedir?",
                  choices: [
                    { id: "a", label: "Propen" },
                    { id: "b", label: "Propan" },
                    { id: "c", label: "Propin" }
                  ],
                  answerId: "a",
                  hint: "üí° 3 karbon + √ßift baƒü = prop + en = propen"
                }
              ]
            }
          ]
        },

        alkinler: {
          id: 'alkinler',
          title: 'Alkinler',
          subtitle: '√ú√ßl√º baƒülƒ± hidrokarbonlar',
          locked: true,
          steps: [
            {
              id: 1,
              title: "√ú√ßl√º Baƒü Tanƒ±ma",
              subtitle: "C‚â°C baƒüƒ±nƒ±n √∂zellikleri",
              questions: [
                {
                  question: "Alkinlerin genel form√ºl√º nedir?",
                  choices: [
                    { id: "a", label: "C‚ÇôH‚ÇÇ‚Çô" },
                    { id: "b", label: "C‚ÇôH‚ÇÇ‚Çô‚Çã‚ÇÇ" },
                    { id: "c", label: "C‚ÇôH‚ÇÇ‚Çô‚Çä‚ÇÇ" }
                  ],
                  answerId: "b",
                  hint: "üí° √ú√ßl√º baƒü = 4 hidrojen eksik"
                }
              ]
            },
            {
              id: 2,
              title: "Numaralandƒ±rma",
              subtitle: "√ú√ßl√º baƒüa en yakƒ±n numara",
              questions: [
                {
                  question: "En basit alkin hangisidir?",
                  choices: [
                    { id: "a", label: "Metin" },
                    { id: "b", label: "Etin (Asetilen)" },
                    { id: "c", label: "Propin" }
                  ],
                  answerId: "b",
                  hint: "üí° √ú√ßl√º baƒü i√ßin en az 2 karbon gerekir."
                }
              ]
            },
            {
              id: 3,
              title: "Asetilen T√ºrevleri",
              subtitle: "Terminal ve internal alkinler",
              questions: [
                {
                  question: "Terminal alkinde √º√ßl√º baƒü nerededir?",
                  choices: [
                    { id: "a", label: "Zincirin ucunda" },
                    { id: "b", label: "Zincirin ortasƒ±nda" },
                    { id: "c", label: "Her iki u√ßta" }
                  ],
                  answerId: "a",
                  hint: "üí° Terminal = u√ßta, Internal = ortada"
                }
              ]
            },
            {
              id: 4,
              title: "Alkil Gruplarƒ±",
              subtitle: "Yan dallar alkinlerde",
              questions: [
                {
                  question: "3-metil-1-butin'de √º√ßl√º baƒü nerededir?",
                  choices: [
                    { id: "a", label: "1-2 arasƒ±" },
                    { id: "b", label: "2-3 arasƒ±" },
                    { id: "c", label: "3-4 arasƒ±" }
                  ],
                  answerId: "a",
                  hint: "üí° 1-butin = 1. karbonda √º√ßl√º baƒü ba≈ülar"
                }
              ]
            },
            {
              id: 5,
              title: "IUPAC Adlandƒ±rma",
              subtitle: "Alkin isimlerini olu≈ütur",
              questions: [
                {
                  question: "CH‚â°C-CH‚ÇÉ bile≈üiƒüinin adƒ± nedir?",
                  choices: [
                    { id: "a", label: "Propen" },
                    { id: "b", label: "Propin" },
                    { id: "c", label: "Propan" }
                  ],
                  answerId: "b",
                  hint: "üí° 3 karbon + √º√ßl√º baƒü = prop + in = propin"
                }
              ]
            }
          ]
        },

        arenler: {
          id: 'arenler',
          title: 'Arenler',
          subtitle: 'Aromatik hidrokarbonlar',
          locked: true,
          steps: [
            {
              id: 1,
              title: "Benzen Halkasƒ±",
              subtitle: "Aromatik yapƒ±nƒ±n temeli",
              questions: [
                {
                  question: "Benzenin molek√ºl form√ºl√º nedir?",
                  choices: [
                    { id: "a", label: "C‚ÇÜH‚ÇÜ" },
                    { id: "b", label: "C‚ÇÜH‚ÇÅ‚ÇÇ" },
                    { id: "c", label: "C‚ÇÜH‚ÇÅ‚ÇÑ" }
                  ],
                  answerId: "a",
                  hint: "üí° Benzen 6 karbon ve 6 hidrojen i√ßerir."
                }
              ]
            },
            {
              id: 2,
              title: "Orto-Meta-Para",
              subtitle: "Disubstit√ºe benzenler",
              questions: [
                {
                  question: "Orto konumu hangi numaralardƒ±r?",
                  choices: [
                    { id: "a", label: "1,2" },
                    { id: "b", label: "1,3" },
                    { id: "c", label: "1,4" }
                  ],
                  answerId: "a",
                  hint: "üí° Orto = yan yana (1,2)"
                }
              ]
            },
            {
              id: 3,
              title: "Alkil Benzenler",
              subtitle: "Toluen, ksilen vs.",
              questions: [
                {
                  question: "Toluen nedir?",
                  choices: [
                    { id: "a", label: "Metilbenzen" },
                    { id: "b", label: "Etilbenzen" },
                    { id: "c", label: "Propilbenzen" }
                  ],
                  answerId: "a",
                  hint: "üí° Toluen = Benzen + Metil grubu"
                }
              ]
            },
            {
              id: 4,
              title: "√áok Halkalƒ±lar",
              subtitle: "Naftalin, antrasen",
              questions: [
                {
                  question: "Naftalin ka√ß benzen halkasƒ± i√ßerir?",
                  choices: [
                    { id: "a", label: "1" },
                    { id: "b", label: "2" },
                    { id: "c", label: "3" }
                  ],
                  answerId: "b",
                  hint: "üí° Naftalin = 2 kayna≈ümƒ±≈ü benzen halkasƒ±"
                }
              ]
            },
            {
              id: 5,
              title: "IUPAC Adlandƒ±rma",
              subtitle: "Aren isimlerini olu≈ütur",
              questions: [
                {
                  question: "1,4-dimetilbenzen'in diƒüer adƒ± nedir?",
                  choices: [
                    { id: "a", label: "o-ksilen" },
                    { id: "b", label: "m-ksilen" },
                    { id: "c", label: "p-ksilen" }
                  ],
                  answerId: "c",
                  hint: "üí° 1,4 = para konumu, ksilen = dimetilbenzen"
                }
              ]
            }
          ]
        }
      },

      interactiveQuestionsStep4: [
        {
          type: "ordering_interactive",
          question: "Alfabetik √∂ncelik: Hangi grup isimlendirmede √∂nce yazƒ±lƒ±r?",
          hint: "üí° Alfabede E harfi M harfinden √∂nce gelir.",
          items: [
            { id: "a", label: "Etil", value: 1 },
            { id: "b", label: "Metil", value: 2 }
          ],
          correctOrder: ["a", "b"]
        },
        {
          type: "ordering_interactive",
          question: "Bu gruplarƒ± alfabetik sƒ±raya koyunuz:",
          hint: "üí° ƒ∞zopropil (i) vs Metil (m). ƒ∞ harfi M'den √∂nce gelir.",
          items: [
            { id: "a", label: "ƒ∞zopropil", value: 1 },
            { id: "b", label: "Metil", value: 2 }
          ],
          correctOrder: ["a", "b"]
        },
        {
          type: "ordering_interactive",
          question: "Hangisi √∂ncelikli?",
          hint: "üí° Kloro (k) vs Bromo (b). B harfi K'den √∂nce gelir.",
          items: [
            { id: "a", label: "Bromo", value: 1 },
            { id: "b", label: "Kloro", value: 2 }
          ],
          correctOrder: ["a", "b"]
        },
        {
          type: "ordering_interactive",
          question: "Sayƒ± √∂n ekleri (di-, tri-) sƒ±ralamayƒ± etkiler mi?",
          hint: "üí° Sƒ±ralamada sadece grup adƒ±na bakƒ±lƒ±r (Dimetil -> M harfi).",
          items: [
            { id: "a", label: "Etil", value: 1 },
            { id: "b", label: "Dimetil", value: 2 }
          ],
          correctOrder: ["a", "b"]
        },
        {
          type: "ordering_interactive",
          question: "Karma≈üƒ±k yapƒ±: Hangisi √∂nce?",
          hint: "üí° B√ºtil (b) vs Etil (e).",
          items: [
            { id: "a", label: "B√ºtil", value: 1 },
            { id: "b", label: "Etil", value: 2 }
          ],
          correctOrder: ["a", "b"]
        }
      ],

      // --- Interactive Numbering Question Data ---
      interactiveQuestionsStep3: [
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° Dallanmanƒ±n en yakƒ±n olduƒüu u√ßtan ba≈üla.",
          moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="50" y1="95" x2="100" y2="95" />
              <line x1="100" y1="95" x2="150" y2="95" />
              <line x1="150" y1="95" x2="200" y2="95" />
              <line x1="200" y1="95" x2="250" y2="95" />
              <line x1="100" y1="95" x2="100" y2="50" /> 
            </g>
            <g class="atoms">
              <circle cx="50" cy="95" r="14" class="atom" data-id="c1" />
              <circle cx="100" cy="95" r="14" class="atom" data-id="c2" />
              <circle cx="150" cy="95" r="14" class="atom" data-id="c3" />
              <circle cx="200" cy="95" r="14" class="atom" data-id="c4" />
              <circle cx="250" cy="95" r="14" class="atom" data-id="c5" />
              <circle cx="100" cy="50" r="14" class="atom" data-id="sub1" fill="#FF6B6B" />
            </g>
          </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 }, // Left to right because branch at 2
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° Saƒüdan ba≈ülarsak dal 2'ye gelir. Soldan ba≈ülarsak 4'e gelir.",
          moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="50" y1="100" x2="100" y2="100" />
              <line x1="100" y1="100" x2="150" y2="100" />
              <line x1="150" y1="100" x2="200" y2="100" />
              <line x1="200" y1="100" x2="250" y2="100" />
              <line x1="200" y1="100" x2="200" y2="60" />
            </g>
            <g class="atoms">
              <circle cx="50" cy="100" r="14" class="atom" data-id="c1" />
              <circle cx="100" cy="100" r="14" class="atom" data-id="c2" />
              <circle cx="150" cy="100" r="14" class="atom" data-id="c3" />
              <circle cx="200" cy="100" r="14" class="atom" data-id="c4" />
              <circle cx="250" cy="100" r="14" class="atom" data-id="c5" />
              <circle cx="200" cy="60" r="14" class="atom" data-id="sub1" fill="#FF6B6B" />
            </g>
          </svg>`,
          correctNumbering: { c5: 1, c4: 2, c3: 3, c2: 4, c1: 5 }, // Right to left
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° Alfabetik √∂ncelik bakarƒ±z ama burada sadece metil var. ƒ∞stediƒüin u√ßtan ba≈üla (simetrik).",
          moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
             <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
               <line x1="50" y1="95" x2="100" y2="95" />
               <line x1="100" y1="95" x2="150" y2="95" />
               <line x1="150" y1="95" x2="200" y2="95" />
               <line x1="200" y1="95" x2="250" y2="95" />
               <line x1="100" y1="95" x2="100" y2="50" />
               <line x1="200" y1="95" x2="200" y2="50" />
             </g>
             <g class="atoms">
               <circle cx="50" cy="95" r="14" class="atom" data-id="c1" />
               <circle cx="100" cy="95" r="14" class="atom" data-id="c2" />
               <circle cx="150" cy="95" r="14" class="atom" data-id="c3" />
               <circle cx="200" cy="95" r="14" class="atom" data-id="c4" />
               <circle cx="250" cy="95" r="14" class="atom" data-id="c5" />
               <circle cx="100" cy="50" r="14" class="atom sub" fill="#FF6B6B" />
               <circle cx="200" cy="50" r="14" class="atom sub" fill="#FF6B6B" />
             </g>
           </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 }, // Accepted solution 1
          secondaryCorrect: { c1: 5, c2: 4, c3: 3, c4: 2, c5: 1 }, // Accepted solution 2
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° 5 karbonlu zincir, dala en yakƒ±n u√ßtan ba≈ülamalƒ±.",
          moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 170" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="50" y1="70" x2="100" y2="45" />
              <line x1="100" y1="45" x2="150" y2="70" />
              <line x1="150" y1="70" x2="200" y2="45" />
              <line x1="200" y1="45" x2="250" y2="70" />
              <line x1="150" y1="70" x2="150" y2="115" />
            </g>
            <g class="atoms">
              <circle cx="50" cy="70" r="14" class="atom" data-id="c1" />
              <circle cx="100" cy="45" r="14" class="atom" data-id="c2" />
              <circle cx="150" cy="70" r="14" class="atom" data-id="c3" />
              <circle cx="200" cy="45" r="14" class="atom" data-id="c4" />
              <circle cx="250" cy="70" r="14" class="atom" data-id="c5" />
              <circle cx="150" cy="115" r="14" class="atom" data-id="sub" fill="#FF6B6B" />
            </g>
           </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 },
          secondaryCorrect: { c5: 1, c4: 2, c3: 3, c2: 4, c1: 5 },
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° Dallar u√ßlara e≈üit uzaklƒ±kta. Bu durumda ALFABETƒ∞K √∂nceliƒüi olan grup k√º√ß√ºk numarayƒ± alƒ±r!",
          moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 350 170" style="background:#2A2342; border-radius:12px;">
             <!-- 6 Carbon Chain -->
             <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
               <line x1="50" y1="100" x2="100" y2="100" />
               <line x1="100" y1="100" x2="150" y2="100" />
               <line x1="150" y1="100" x2="200" y2="100" />
               <line x1="200" y1="100" x2="250" y2="100" />
               <line x1="250" y1="100" x2="300" y2="100" />
               
               <!-- Branches -->
               <!-- C3 branch (Ethyl - 2 carbons) -->
               <line x1="150" y1="100" x2="150" y2="60" />
               <line x1="150" y1="60" x2="150" y2="30" />
               
               <!-- C4 branch (Methyl - 1 carbon) -->
               <line x1="200" y1="100" x2="200" y2="60" />
             </g>
             <g class="atoms">
               <circle cx="50" cy="100" r="12" class="atom" data-id="c1" />
               <circle cx="100" cy="100" r="12" class="atom" data-id="c2" />
               <circle cx="150" cy="100" r="12" class="atom" data-id="c3" />
               <circle cx="200" cy="100" r="12" class="atom" data-id="c4" />
               <circle cx="250" cy="100" r="12" class="atom" data-id="c5" />
               <circle cx="300" cy="100" r="12" class="atom" data-id="c6" />
               
               <!-- Subs -->
               <circle cx="150" cy="60" r="10" class="atom sub" fill="#FF6B6B" /> <!-- Ethyl C1 -->
               <circle cx="150" cy="30" r="10" class="atom sub" fill="#FF6B6B" />  <!-- Ethyl C2 -->
               
               <circle cx="200" cy="60" r="10" class="atom sub" fill="#FF9F43" /> <!-- Methyl -->
             </g>
           </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5, c6: 6 },
          userNumbering: {}
        },
        // --- NEW INTERACTIVE QUESTIONS ---
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° D√ºz zincir - herhangi bir u√ßtan ba≈ülayabilirsin.",
          moleculeSVG: `<svg width="100%" height="180" viewBox="0 0 280 120" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="50" y1="60" x2="110" y2="60" />
              <line x1="110" y1="60" x2="170" y2="60" />
              <line x1="170" y1="60" x2="230" y2="60" />
            </g>
            <g class="atoms">
              <circle cx="50" cy="60" r="14" class="atom" data-id="c1" />
              <circle cx="110" cy="60" r="14" class="atom" data-id="c2" />
              <circle cx="170" cy="60" r="14" class="atom" data-id="c3" />
              <circle cx="230" cy="60" r="14" class="atom" data-id="c4" />
            </g>
          </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4 },
          secondaryCorrect: { c4: 1, c3: 2, c2: 3, c1: 4 },
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° 4 karbonlu ana zincir, 2. karbonda dal olmalƒ±.",
          moleculeSVG: `<svg width="100%" height="180" viewBox="0 0 280 150" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="50" y1="90" x2="110" y2="90" />
              <line x1="110" y1="90" x2="170" y2="90" />
              <line x1="170" y1="90" x2="230" y2="90" />
              <line x1="110" y1="90" x2="110" y2="45" />
            </g>
            <g class="atoms">
              <circle cx="50" cy="90" r="14" class="atom" data-id="c1" />
              <circle cx="110" cy="90" r="14" class="atom" data-id="c2" />
              <circle cx="170" cy="90" r="14" class="atom" data-id="c3" />
              <circle cx="230" cy="90" r="14" class="atom" data-id="c4" />
              <circle cx="110" cy="45" r="12" class="atom sub" fill="#FF6B6B" />
            </g>
          </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4 },
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° En uzun zincir 7 karbonlu - dalƒ±n en yakƒ±n olduƒüu u√ßtan ba≈üla.",
          moleculeSVG: `<svg width="100%" height="180" viewBox="0 0 400 150" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="40" y1="90" x2="90" y2="90" />
              <line x1="90" y1="90" x2="140" y2="90" />
              <line x1="140" y1="90" x2="190" y2="90" />
              <line x1="190" y1="90" x2="240" y2="90" />
              <line x1="240" y1="90" x2="290" y2="90" />
              <line x1="290" y1="90" x2="340" y2="90" />
              <line x1="140" y1="90" x2="140" y2="45" />
            </g>
            <g class="atoms">
              <circle cx="40" cy="90" r="12" class="atom" data-id="c1" />
              <circle cx="90" cy="90" r="12" class="atom" data-id="c2" />
              <circle cx="140" cy="90" r="12" class="atom" data-id="c3" />
              <circle cx="190" cy="90" r="12" class="atom" data-id="c4" />
              <circle cx="240" cy="90" r="12" class="atom" data-id="c5" />
              <circle cx="290" cy="90" r="12" class="atom" data-id="c6" />
              <circle cx="340" cy="90" r="12" class="atom" data-id="c7" />
              <circle cx="140" cy="45" r="10" class="atom sub" fill="#FF6B6B" />
            </g>
          </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5, c6: 6, c7: 7 },
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° 2+4=6 veya 2+4=6 - simetrik olduƒüundan her iki y√∂n de doƒüru!",
          moleculeSVG: `<svg width="100%" height="180" viewBox="0 0 320 150" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="50" y1="90" x2="100" y2="90" />
              <line x1="100" y1="90" x2="160" y2="90" />
              <line x1="160" y1="90" x2="220" y2="90" />
              <line x1="220" y1="90" x2="270" y2="90" />
              <line x1="100" y1="90" x2="100" y2="45" />
              <line x1="220" y1="90" x2="220" y2="45" />
            </g>
            <g class="atoms">
              <circle cx="50" cy="90" r="12" class="atom" data-id="c1" />
              <circle cx="100" cy="90" r="12" class="atom" data-id="c2" />
              <circle cx="160" cy="90" r="12" class="atom" data-id="c3" />
              <circle cx="220" cy="90" r="12" class="atom" data-id="c4" />
              <circle cx="270" cy="90" r="12" class="atom" data-id="c5" />
              <circle cx="100" cy="45" r="10" class="atom sub" fill="#FF6B6B" />
              <circle cx="220" cy="45" r="10" class="atom sub" fill="#FF9F43" />
            </g>
          </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 },
          secondaryCorrect: { c5: 1, c4: 2, c3: 3, c2: 4, c1: 5 },
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° 6 karbonlu ana zincir, 3. karbonda 2 karbonlu dal var.",
          moleculeSVG: `<svg width="100%" height="200" viewBox="0 0 360 160" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="40" y1="100" x2="90" y2="100" />
              <line x1="90" y1="100" x2="140" y2="100" />
              <line x1="140" y1="100" x2="190" y2="100" />
              <line x1="190" y1="100" x2="240" y2="100" />
              <line x1="240" y1="100" x2="290" y2="100" />
              <line x1="140" y1="100" x2="140" y2="55" />
              <line x1="140" y1="55" x2="140" y2="20" />
            </g>
            <g class="atoms">
              <circle cx="40" cy="100" r="12" class="atom" data-id="c1" />
              <circle cx="90" cy="100" r="12" class="atom" data-id="c2" />
              <circle cx="140" cy="100" r="12" class="atom" data-id="c3" />
              <circle cx="190" cy="100" r="12" class="atom" data-id="c4" />
              <circle cx="240" cy="100" r="12" class="atom" data-id="c5" />
              <circle cx="290" cy="100" r="12" class="atom" data-id="c6" />
              <circle cx="140" cy="55" r="10" class="atom sub" fill="#FF6B6B" />
              <circle cx="140" cy="20" r="10" class="atom sub" fill="#FF6B6B" />
            </g>
          </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5, c6: 6 },
          secondaryCorrect: { c6: 1, c5: 2, c4: 3, c3: 4, c2: 5, c1: 6 },
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° Aynƒ± karbonda iki dal var. Yine de en yakƒ±n u√ßtan ba≈ülamalƒ±yƒ±z (Sol).",
          moleculeSVG: `<svg width="100%" height="220" viewBox="0 0 300 150" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="50" y1="95" x2="100" y2="95" />
              <line x1="100" y1="95" x2="150" y2="95" />
              <line x1="150" y1="95" x2="200" y2="95" />
              <line x1="200" y1="95" x2="250" y2="95" />
              <line x1="100" y1="95" x2="100" y2="50" /> 
              <line x1="100" y1="95" x2="100" y2="140" /> 
            </g>
            <g class="atoms">
              <circle cx="50" cy="95" r="14" class="atom" data-id="c1" />
              <circle cx="100" cy="95" r="14" class="atom" data-id="c2" />
              <circle cx="150" cy="95" r="14" class="atom" data-id="c3" />
              <circle cx="200" cy="95" r="14" class="atom" data-id="c4" />
              <circle cx="250" cy="95" r="14" class="atom" data-id="c5" />
              <circle cx="100" cy="50" r="14" class="atom sub" fill="#FF6B6B" />
              <circle cx="100" cy="140" r="14" class="atom sub" fill="#FF6B6B" />
            </g>
          </svg>`,
          correctNumbering: { c1: 1, c2: 2, c3: 3, c4: 4, c5: 5 },
          userNumbering: {}
        },
        {
          type: "numbering_interactive",
          question: "A≈üaƒüƒ±daki bile≈üiƒüi numaralandƒ±rƒ±nƒ±z.",
          hint: "üí° Dallanmalar farklƒ± yerlerde. En yakƒ±n ilk dallanma √∂nemli (Saƒüda 2. karbon).",
          moleculeSVG: `<svg width="100%" height="200" viewBox="0 0 350 160" style="background:#2A2342; border-radius:12px;">
            <g class="bonds" stroke="rgba(255,255,255,0.3)" stroke-width="4">
              <line x1="40" y1="100" x2="90" y2="100" />
              <line x1="90" y1="100" x2="140" y2="100" />
              <line x1="140" y1="100" x2="190" y2="100" />
              <line x1="190" y1="100" x2="240" y2="100" />
              <line x1="240" y1="100" x2="290" y2="100" />
              
              <line x1="140" y1="100" x2="140" y2="60" /> 
              <line x1="240" y1="100" x2="240" y2="60" /> 
            </g>
            <g class="atoms">
              <circle cx="40" cy="100" r="12" class="atom" data-id="c1" />
              <circle cx="90" cy="100" r="12" class="atom" data-id="c2" />
              <circle cx="140" cy="100" r="12" class="atom" data-id="c3" />
              <circle cx="190" cy="100" r="12" class="atom" data-id="c4" />
              <circle cx="240" cy="100" r="12" class="atom" data-id="c5" />
              <circle cx="290" cy="100" r="12" class="atom" data-id="c6" />
              
              <circle cx="140" cy="60" r="10" class="atom sub" fill="#FF6B6B" />
              <circle cx="240" cy="60" r="10" class="atom sub" fill="#FF6B6B" />
            </g>
          </svg>`,
          correctNumbering: { c6: 1, c5: 2, c4: 3, c3: 4, c2: 5, c1: 6 },
          userNumbering: {}
        }
      ]
    };

    // Backward compatibility alias
    const alkaneSteps = {
      get completedSteps() { return topicsData.progress.alkanlar; },
      set completedSteps(val) { topicsData.progress.alkanlar = val; },
      get currentStep() { return topicsData.currentStep; },
      set currentStep(val) { topicsData.currentStep = val; },
      get currentQuestionIndex() { return topicsData.currentQuestionIndex; },
      set currentQuestionIndex(val) { topicsData.currentQuestionIndex = val; },
      get selectedAnswer() { return topicsData.selectedAnswer; },
      set selectedAnswer(val) { topicsData.selectedAnswer = val; },
      get activeQuestions() { return topicsData.activeQuestions; },
      set activeQuestions(val) { topicsData.activeQuestions = val; },
      get maxQuestionsPerStep() { return topicsData.maxQuestionsPerStep; },
      get steps() { return topicsData.topics.alkanlar.steps; }
    };

    // Render steps for current topic (generic for all topics)
    function renderTopicSteps() {
      const topicId = topicsData.currentTopic;
      const topic = topicsData.topics[topicId];
      if (!topic) return;

      const completed = topicsData.progress[topicId] || [];
      const steps = topic.steps;

      // Update section title
      const titleEl = document.querySelector('#sec-alkane-steps .h2');
      const subtitleEl = document.querySelector('#sec-alkane-steps .muted.small');
      if (titleEl) titleEl.textContent = `${topic.title} - IUPAC Adlandƒ±rma`;
      if (subtitleEl) subtitleEl.textContent = topic.subtitle;

      // Update step items dynamically
      const listEl = document.getElementById('alkaneStepsList');
      if (listEl) {
        listEl.innerHTML = '';

        steps.forEach((step, idx) => {
          const stepNum = idx + 1;
          const isCompleted = completed.includes(stepNum);
          const badgeEl = document.getElementById('devBadge');
          const isDev = devMode || document.body.classList.contains('dev') || (badgeEl && badgeEl.style.display !== 'none');
          const isUnlocked = stepNum === 1 || completed.includes(stepNum - 1) || isDev;

          const div = document.createElement('div');
          div.className = `tile step-item ${isCompleted ? 'completed' : ''} ${!isUnlocked ? 'locked' : ''}`;
          div.dataset.step = stepNum;
          div.onclick = () => goTopicStep(stepNum);

          let tagText = 'üîí';
          if (isCompleted) tagText = '‚úì Tamamlandƒ±';
          else if (isUnlocked) tagText = 'Ba≈üla ‚Üí';

          div.innerHTML = `
            <div class="row">
              <div style="display:flex;gap:12px;align-items:center">
                <div class="step-badge">${stepNum}</div>
                <div>
                  <div class="t" style="font-size:16px;">${step.title}</div>
                  <div class="muted small" style="margin-top:4px;">${step.subtitle}</div>
                </div>
              </div>
              <span class="tag">${tagText}</span>
            </div>
          `;
          listEl.appendChild(div);
        });
      }

      // Update progress bar
      const progressBar = document.getElementById('alkaneProgress');
      const progressText = document.getElementById('alkaneProgressText');
      if (progressBar && progressText) {
        const percent = (completed.length / steps.length) * 100;
        progressBar.style.width = percent + '%';
        progressText.textContent = `${completed.length}/${steps.length} adƒ±m tamamlandƒ±`;
      }
    }

    // Go to specific step in current topic
    function goTopicStep(stepNum) {
      const topicId = topicsData.currentTopic;
      const completed = topicsData.progress[topicId] || [];

      // Check if locked (bypass in dev mode)
      const badgeEl = document.getElementById('devBadge');
      const isDev = devMode || document.body.classList.contains('dev') || (badgeEl && badgeEl.style.display !== 'none');
      if (!isDev && stepNum > 1 && !completed.includes(stepNum - 1)) {
        return; // Locked
      }

      // If step is already completed, show restart options
      if (completed.includes(stepNum)) {
        showRestartModal(stepNum);
        return;
      }

      startStepWithNewQuestions(stepNum);
    }

    function renderAlkaneSteps() {
      topicsData.currentTopic = 'alkanlar';
      renderTopicSteps();
    }

    // Shuffle array and pick n items
    function shuffleAndPick(arr, n) {
      const shuffled = [...arr].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, n);
    }

    function goAlkaneStep(stepNum) {
      const completed = alkaneSteps.completedSteps;

      // Check if locked (bypass in dev mode)
      if (!devMode && stepNum > 1 && !completed.includes(stepNum - 1)) {
        return; // Locked
      }

      // If step is already completed, show restart options
      if (completed.includes(stepNum)) {
        showRestartModal(stepNum);
        return;
      }

      // Start new step
      startStepWithNewQuestions(stepNum);
    }

    function showRestartModal(stepNum) {
      const topicId = topicsData.currentTopic;
      const topic = topicsData.topics[topicId];
      const step = topic.steps.find(s => s.id === stepNum);
      const modal = document.createElement("div");
      modal.id = "restartModal";
      modal.style.cssText = `
        position: fixed; inset: 0; z-index: 100;
        background: rgba(0,0,0,0.7);
        display: flex; align-items: center; justify-content: center;
        backdrop-filter: blur(4px);
      `;
      modal.innerHTML = `
        <div style="
          background: var(--surface);
          border: 1px solid var(--stroke);
          border-radius: var(--r24);
          padding: 24px;
          max-width: 340px;
          text-align: center;
          box-shadow: var(--shadow);
        ">
          <div style="font-size:40px; margin-bottom:12px;">üîÑ</div>
          <div class="h2" style="margin-bottom:8px;">${step.title}</div>
          <div class="muted small" style="margin-bottom:20px;">Bu adƒ±mƒ± daha √∂nce tamamladƒ±n. Nasƒ±l devam etmek istersin?</div>
          
          <div style="display:flex; flex-direction:column; gap:10px;">
            <button class="btn" onclick="startStepWithNewQuestions(${stepNum}); closeRestartModal();">
              üé≤ Farklƒ± Sorular
            </button>
            <button class="btn secondary" onclick="startStepSameQuestions(${stepNum}); closeRestartModal();">
              üîÅ Ba≈ütan Ba≈üla
            </button>
            <button class="btn ghost" onclick="closeRestartModal();">
              ƒ∞ptal
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function closeRestartModal() {
      const modal = document.getElementById("restartModal");
      if (modal) modal.remove();
    }

    function startStepWithNewQuestions(stepNum) {
      const topicId = topicsData.currentTopic;
      const topic = topicsData.topics[topicId];
      const step = topic.steps.find(s => s.id === stepNum);

      // 1. Pick Standard Questions
      const standardPool = step.questions || [];
      let pickCount = 5;
      if (stepNum === 5) pickCount = 10; // Step 5 has 10 questions
      const standardPicked = shuffleAndPick(standardPool, pickCount);

      // 2. Pick 5 Interactive Questions (Last 5)
      let interactivePool = [];

      if (stepNum === 1) {
        interactivePool = topicsData.interactiveQuestions || [];
      } else if (stepNum === 2) {
        interactivePool = topicsData.interactiveQuestionsStep2 || [];
      } else if (stepNum === 3) {
        interactivePool = topicsData.interactiveQuestionsStep3 || [];
      } else if (stepNum === 4) {
        interactivePool = topicsData.interactiveQuestionsStep4 || [];
      }
      const interactivePicked = shuffleAndPick(interactivePool, 5);

      // Combine: First 5 Standard, Last 5 Interactive
      topicsData.activeQuestions = [...standardPicked, ...interactivePicked];

      topicsData.currentStep = stepNum;
      topicsData.currentQuestionIndex = 0;
      topicsData.selectedAnswer = null;
      topicsData.selectedChain = []; // New chain selection state
      topicsData.correctCount = 0; // Accuracy tracking
      topicsData.wrongCount = 0;   // Accuracy tracking

      go("alkane-question");
      renderStepQuestion();
    }

    function startStepSameQuestions(stepNum) {
      const topicId = topicsData.currentTopic;
      const topic = topicsData.topics[topicId];
      const step = topic.steps.find(s => s.id === stepNum);

      // 1. First Standard (No shuffle)
      const standardPool = step.questions || [];
      let pickCount = 5;
      if (stepNum === 5) pickCount = 10;
      const standardPicked = standardPool.slice(0, pickCount);

      // 2. First 5 Interactive (No shuffle)
      const interactivePool = topicsData.interactiveQuestions || [];
      const interactivePicked = interactivePool.slice(0, 5);

      topicsData.activeQuestions = [...standardPicked, ...interactivePicked];

      topicsData.currentStep = stepNum;
      topicsData.currentQuestionIndex = 0;
      topicsData.selectedAnswer = null;
      topicsData.selectedChain = [];
      topicsData.correctCount = 0; // Accuracy tracking
      topicsData.wrongCount = 0;   // Accuracy tracking

      go("alkane-question");
      renderStepQuestion();
    }

    // --- Render Helpers ---

    function renderChainSelection(q) {
      const molDiv = document.getElementById("stepMolecule");
      const choicesDiv = document.getElementById("stepChoices");

      molDiv.style.display = "block";
      molDiv.innerHTML = q.moleculeSVG;

      // Add listeners to atoms
      const atoms = molDiv.querySelectorAll(".atom");
      const svg = molDiv.querySelector("svg");
      atoms.forEach(a => a.style.cursor = "pointer");

      svg.onclick = (e) => {
        if (document.getElementById("stepNotice").style.display === "block") return;

        let pt = svg.createSVGPoint();
        pt.x = e.clientX;
        pt.y = e.clientY;
        const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());

        let closest = null;
        let minDst = 45;

        atoms.forEach(atom => {
          const cx = parseFloat(atom.getAttribute("cx"));
          const cy = parseFloat(atom.getAttribute("cy"));
          const dx = cx - svgP.x;
          const dy = cy - svgP.y;
          const dist = Math.sqrt(dx * dx + dy * dy);

          if (dist < minDst) {
            minDst = dist;
            closest = atom;
          }
        });

        if (closest) {
          const id = closest.dataset.id;
          const idx = topicsData.selectedChain.indexOf(id);

          if (idx > -1) {
            topicsData.selectedChain.splice(idx, 1);
            closest.classList.remove("selected");
          } else {
            topicsData.selectedChain.push(id);
            closest.classList.add("selected");
          }
          document.getElementById("stepCheck").disabled = topicsData.selectedChain.length === 0;
        }
      };

      // Restore previous state if any
      if (topicsData.selectedChain.length > 0) {
        topicsData.selectedChain.forEach(id => {
          const atom = molDiv.querySelector(`.atom[data-id="${id}"]`);
          if (atom) atom.classList.add("selected");
        });
      }

      choicesDiv.innerHTML = "<div class='muted small' style='text-align:center'>G√∂rseldeki karbonlara tƒ±klayarak en uzun zinciri olu≈üturun.</div>";
    }

    function renderOrderingInteractive(q) {
      const molDiv = document.getElementById("stepMolecule");
      const choicesDiv = document.getElementById("stepChoices");
      molDiv.style.display = "none";
      choicesDiv.innerHTML = `
          <div style="display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin-bottom:12px;">
             ${q.items.map(item => `
               <div class="choice ordering-item" data-id="${item.id}" onclick="handleOrderingClick(this, '${item.id}')">
                 <div style="font-size:18px; font-weight:bold;">${item.label}</div>
                 ${item.value ? `<div class="muted small" style="margin-top:4px;">(√ñncelik: ${item.value})</div>` : ''}
               </div>
             `).join('')}
          </div>
          <div class="muted small" style="text-align:center">√ñncelikli olan grubu se√ßin. (Sƒ±ralama sorularƒ± i√ßin s√ºr√ºkle-bƒ±rak eklenebilir)</div>
       `;
    }

    function renderNumberingInteractive(q) {
      const molDiv = document.getElementById("stepMolecule");
      const choicesDiv = document.getElementById("stepChoices");
      molDiv.style.display = "block";
      molDiv.innerHTML = q.moleculeSVG;

      if (!q.userNumbering) q.userNumbering = {};

      choicesDiv.innerHTML = `
          <div style="display:flex; justify-content:center; align-items:center; gap:16px; margin-bottom:12px;">
             <div class="pill" id="numModeBadge" style="background:var(--primary); cursor:default;">
               <span>1Ô∏è‚É£</span> <span>Sƒ±radaki: 1</span>
             </div>
             <div class="muted small">Tƒ±kla: Sayƒ± ver</div>
          </div>
          <div class="muted small" style="text-align:center">Yanlƒ±≈ü verdiƒüin sayƒ±ya tekrar tƒ±klayarak o sayƒ±dan sonrasƒ±nƒ± silebilirsin.</div>
        `;

      const atoms = molDiv.querySelectorAll(".atom");
      const svg = molDiv.querySelector("svg");
      atoms.forEach(a => a.style.cursor = "pointer");

      const updateVisuals = () => {
        let maxNum = 0;
        for (let id in q.userNumbering) {
          const num = q.userNumbering[id];
          if (num > maxNum) maxNum = num;
          const atom = molDiv.querySelector(`.atom[data-id="${id}"]`);
          if (atom) {
            atom.setAttribute("fill", "#4CAF50"); // Green
            // Add label text
            let txt = molDiv.querySelector(`.num-label[data-for="${id}"]`);
            if (!txt) {
              txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
              txt.setAttribute("x", atom.getAttribute("cx"));
              txt.setAttribute("y", parseFloat(atom.getAttribute("cy")) + 5);
              txt.setAttribute("text-anchor", "middle");
              txt.setAttribute("fill", "white");
              txt.setAttribute("font-size", "14");
              txt.setAttribute("font-weight", "bold");
              txt.setAttribute("pointer-events", "none");
              txt.classList.add("num-label");
              txt.dataset.for = id;
              svg.appendChild(txt);
            }
            txt.textContent = num;
          }
        }
        document.getElementById("numModeBadge").innerHTML = `<span>1Ô∏è‚É£</span> <span>Sƒ±radaki: ${maxNum + 1}</span>`;
        document.getElementById("stepCheck").disabled = maxNum === 0;
      };

      svg.onclick = (e) => {
        if (document.getElementById("stepNotice").style.display === "block") return;

        let pt = svg.createSVGPoint();
        pt.x = e.clientX;
        pt.y = e.clientY;
        const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());

        let closest = null;
        let minDst = 45;
        atoms.forEach(atom => {
          const cx = parseFloat(atom.getAttribute("cx"));
          const cy = parseFloat(atom.getAttribute("cy"));
          const dist = Math.sqrt(Math.pow(cx - svgP.x, 2) + Math.pow(cy - svgP.y, 2));
          if (dist < minDst) { minDst = dist; closest = atom; }
        });

        if (closest) {
          const id = closest.dataset.id;
          if (q.userNumbering[id]) {
            // Remove this and higher
            const clickedNum = q.userNumbering[id];
            for (let key in q.userNumbering) {
              if (q.userNumbering[key] >= clickedNum) {
                delete q.userNumbering[key];
                const atom = molDiv.querySelector(`.atom[data-id="${key}"]`);
                if (atom) atom.setAttribute("fill", ""); // Reset color
                const lbl = molDiv.querySelector(`.num-label[data-for="${key}"]`);
                if (lbl) lbl.remove();
              }
            }
          } else {
            // Add next number
            let maxNum = 0;
            Object.values(q.userNumbering).forEach(v => maxNum = Math.max(maxNum, v));
            q.userNumbering[id] = maxNum + 1;
          }
          updateVisuals();
        }
      };

      // Init visuals if returning
      updateVisuals();
    }

    function renderNameBuilder(q) {
      const molDiv = document.getElementById("stepMolecule");
      const choicesDiv = document.getElementById("stepChoices");

      molDiv.style.display = "block";
      molDiv.innerHTML = q.moleculeSVG || "";

      if (!q.userSequence) q.userSequence = [];

      const renderBuilder = () => {
        let html = `
               <div id="nameBuilderDropZone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" 
                    style="min-height:60px; border:2px dashed rgba(255,255,255,0.2); border-radius:12px; margin-bottom:20px; display:flex; gap:8px; align-items:center; padding:10px; flex-wrap:wrap; background:rgba(0,0,0,0.2);">
                  ${q.userSequence.length === 0 ? '<div class="muted small">Olu≈üturmak i√ßin par√ßalarƒ± buraya s√ºr√ºkleyin...</div>' : ''}
                  ${q.userSequence.map((item, idx) => `
                    <div class="pill" onclick="window.handleBuilderRemove(${idx})" style="cursor:pointer; background:#7C5CFF; border:none; padding:6px 14px;">
                      ${item} <span style="opacity:0.6; margin-left:6px;">‚úï</span>
                    </div>
                  `).join('')}
               </div>

               <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
                 <div style="width:100%; text-align:center; margin-bottom:10px; font-size:12px; opacity:0.7;">Par√ßalar (Tƒ±klayabilir veya S√ºr√ºkleyebilirsiniz):</div>
                 ${q.tokens.map(token => `
                    <div class="choice" draggable="true" ondragstart="window.handleDragStart(event, '${token}')" onclick="window.handleBuilderAdd('${token}')" style="width:auto; min-width:40px; padding:8px 16px; cursor:grab; user-select:none;">${token}</div>
                 `).join('')}
               </div>
             `;
        choicesDiv.innerHTML = html;
        document.getElementById("stepCheck").disabled = q.userSequence.length === 0;
      };

      window.handleBuilderAdd = (token) => {
        q.userSequence.push(token);
        renderBuilder();
      };
      window.handleBuilderRemove = (idx) => {
        q.userSequence.splice(idx, 1);
        renderBuilder();
      };

      renderBuilder();
    }

    function renderStandardQuestion(q) {
      const molDiv = document.getElementById("stepMolecule");
      const choicesDiv = document.getElementById("stepChoices");
      topicsData.selectedAnswer = null;

      if (q.molecule) {
        molDiv.style.display = "block";
        molDiv.innerHTML = q.molecule;
      } else {
        molDiv.style.display = "none";
        molDiv.innerHTML = "";
      }

      const hasVisual = q.choices.some(c => c.molecule || c.image);
      const isTF = q.choices.length === 2 && (q.choices[0].label === "Doƒüru" || q.choices[0].label === "Yanlƒ±≈ü");

      choicesDiv.className = "choices";
      if (hasVisual) choicesDiv.classList.add("grid");
      if (isTF) choicesDiv.classList.add("tf");

      choicesDiv.innerHTML = "";
      q.choices.forEach(c => {
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.dataset.id = c.id;

        let content = "";
        if (c.molecule) content += `<div style="margin-bottom:4px; pointer-events:none;">${c.molecule}</div>`;
        if (c.image) content += `<img src="${c.image}" style="width:100px; height:auto; margin-bottom:4px; pointer-events:none;">`;
        content += `<div>${c.label}</div>`;

        btn.innerHTML = content;
        btn.onclick = () => {
          topicsData.selectedAnswer = c.id;
          document.querySelectorAll("#stepChoices .choice").forEach(x => x.classList.remove("selected"));
          btn.classList.add("selected");
          document.getElementById("stepCheck").disabled = false;
        };
        choicesDiv.appendChild(btn);
      });
    }

    function renderComprehensive(q) {
      if (typeof q.stage === 'undefined') q.stage = 0;

      const titles = ["Ana Zincir Se√ßimi", "Numaralandƒ±rma", "ƒ∞simlendirme"];
      const subSub = document.getElementById("stepSubtitle");
      if (subSub) subSub.textContent = `Soru ${topicsData.currentQuestionIndex + 1}/${topicsData.activeQuestions.length} - ${titles[q.stage]}`;

      if (q.stage === 0) {
        renderChainSelection(q);
      } else if (q.stage === 1) {
        q.stages[1].userNumbering = q.stages[1].userNumbering || {};
        renderNumberingInteractive({
          ...q.stages[1],
          moleculeSVG: q.moleculeSVG,
          userNumbering: q.stages[1].userNumbering
        });
      } else if (q.stage === 2) {
        q.stages[2].userSequence = q.stages[2].userSequence || [];
        renderNameBuilder({
          ...q.stages[2],
          moleculeSVG: q.moleculeSVG,
          userSequence: q.stages[2].userSequence
        });
      }
    }

    function renderStepQuestion() {
      const qIdx = topicsData.currentQuestionIndex;
      const questions = topicsData.activeQuestions;
      if (!questions || !questions[qIdx]) return;
      const q = questions[qIdx];

      // Reset chain selection to prevent ghost data from previous questions
      // ONLY if not a multi-stage comprehensive question intermediate stage
      if (q.type !== 'comprehensive' || !q.stage || q.stage === 0) {
        topicsData.selectedChain = [];
        document.querySelectorAll(".ordering-item").forEach(x => x.classList.remove("selected"));
      }

      const topicId = topicsData.currentTopic;
      const topic = topicsData.topics[topicId];
      const step = topic.steps.find(s => s.id === topicsData.currentStep);

      document.getElementById("stepTitle").textContent = `${topic.title} - Adƒ±m ${step.id}: ${step.title}`;
      document.getElementById("stepSubtitle").textContent = `Soru ${qIdx + 1}/${questions.length}`;
      document.getElementById("stepQuestion").textContent = q.question;

      // Reset UI Generic Controls
      document.getElementById("stepCheck").disabled = true;
      document.getElementById("stepCheck").style.display = "inline-flex";
      document.getElementById("stepNext").style.display = "none";
      document.getElementById("stepNotice").style.display = "none";

      const hintEl = document.getElementById("stepHint");
      hintEl.textContent = "";
      hintEl.style.display = "none";
      hintEl.dataset.hint = q.hint || "";

      // Dispatch Render Logic
      if (q.type === 'chain_selection') renderChainSelection(q);
      else if (q.type === 'ordering_interactive') renderOrderingInteractive(q);
      else if (q.type === 'numbering_interactive') renderNumberingInteractive(q);
      else if (q.type === 'name_builder') renderNameBuilder(q);
      else if (q.type === 'comprehensive') renderComprehensive(q);
      else renderStandardQuestion(q);
    }

    function renderStepQuestion_OLD() {
      // Reset chain selection to prevent ghost data from previous questions
      topicsData.selectedChain = [];

      const topicId = topicsData.currentTopic;
      const topic = topicsData.topics[topicId];
      const step = topic.steps.find(s => s.id === topicsData.currentStep);

      const qIdx = topicsData.currentQuestionIndex;
      const questions = topicsData.activeQuestions;
      const q = questions[qIdx];

      document.getElementById("stepTitle").textContent = `${topic.title} - Adƒ±m ${step.id}: ${step.title}`;
      document.getElementById("stepSubtitle").textContent = `Soru ${qIdx + 1}/${questions.length}`;
      document.getElementById("stepQuestion").textContent = q.question;

      const molDiv = document.getElementById("stepMolecule");
      const choicesDiv = document.getElementById("stepChoices");
      choicesDiv.innerHTML = "";
      choicesDiv.className = "choices";

      // --- Interactive Chain Selection ---
      if (q.type === "chain_selection") {
        molDiv.style.display = "block";
        molDiv.innerHTML = q.moleculeSVG;

        // Add listeners to atoms with enlarged hitboxes
        const atoms = molDiv.querySelectorAll(".atom");
        const svg = molDiv.querySelector("svg");

        // Ensure standard cursor for atoms
        atoms.forEach(a => a.style.cursor = "pointer");

        // Unified SVG Click Handler (Distance Based)
        svg.onclick = (e) => {
          // Prevent interaction after answering
          if (document.getElementById("stepNotice").style.display === "block") return;

          // Convert screen coords to SVG coords
          let pt = svg.createSVGPoint();
          pt.x = e.clientX;
          pt.y = e.clientY;
          const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());

          // Find closest atom within range (45px tolerance)
          let closest = null;
          let minDst = 45;

          atoms.forEach(atom => {
            const cx = parseFloat(atom.getAttribute("cx"));
            const cy = parseFloat(atom.getAttribute("cy"));
            const dx = cx - svgP.x;
            const dy = cy - svgP.y;
            const dist = Math.sqrt(dx * dx + dy * dy);

            if (dist < minDst) {
              minDst = dist;
              closest = atom;
            }
          });

          // Toggle selection if atom found
          if (closest) {
            const id = closest.dataset.id;
            const idx = topicsData.selectedChain.indexOf(id);

            if (idx > -1) {
              topicsData.selectedChain.splice(idx, 1);
              closest.classList.remove("selected");
            } else {
              topicsData.selectedChain.push(id);
              closest.classList.add("selected");
            }
            document.getElementById("stepCheck").disabled = topicsData.selectedChain.length === 0;
          }
        };

        // Hide standard choices area for interactive layout (or keep empty)
        choicesDiv.innerHTML = "<div class='muted small' style='text-align:center'>G√∂rseldeki karbonlara tƒ±klayarak en uzun zinciri olu≈üturun.</div>";

      }
      // --- Interactive Ordering Question ---
      else if (q.type === "ordering_interactive") {
        molDiv.style.display = "none";

        // Show ordering area
        choicesDiv.innerHTML = `
          <div style="display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin-bottom:12px;">
             ${q.items.map(item => `
               <div class="choice ordering-item" data-id="${item.id}" onclick="handleOrderingClick(this, '${item.id}')">
                 <div style="font-size:18px; font-weight:bold;">${item.label}</div>
                 ${item.value ? `<div class="muted small" style="margin-top:4px;">(√ñncelik: ${item.value})</div>` : ''}
               </div>
             `).join('')}
          </div>
          <div class="muted small" style="text-align:center">√ñncelikli olan grubu se√ßin. (Sƒ±ralama sorularƒ± i√ßin s√ºr√ºkle-bƒ±rak eklenebilir)</div>
        `;
      }
      // --- Interactive Numbering Game ---
      else if (q.type === "numbering_interactive") {
        molDiv.style.display = "block";
        molDiv.innerHTML = q.moleculeSVG;

        // Reset user numbering for this question instance
        q.userNumbering = {};

        // Add Numbering Controls
        choicesDiv.innerHTML = `
          <div style="display:flex; justify-content:center; align-items:center; gap:16px; margin-bottom:12px;">
             <div class="pill" id="numModeBadge" style="background:var(--primary); cursor:default;">
               <span>1Ô∏è‚É£</span> <span>Sƒ±radaki: 1</span>
             </div>
             <div class="muted small">Tƒ±kla: Sayƒ± ver</div>
          </div>
          <div class="muted small" style="text-align:center">Yanlƒ±≈ü verdiƒüin sayƒ±ya tekrar tƒ±klayarak o sayƒ±dan sonrasƒ±nƒ± silebilirsin.</div>
        `;

        // Add click listeners to atoms
        const atoms = molDiv.querySelectorAll(".atom");
        const svg = molDiv.querySelector("svg");

        atoms.forEach(a => a.style.cursor = "pointer");

        // Unified SVG Click Handler
        svg.onclick = (e) => {
          if (document.getElementById("stepNotice").style.display === "block") return;

          let pt = svg.createSVGPoint();
          pt.x = e.clientX;
          pt.y = e.clientY;
          const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());

          let closest = null;
          let minDst = 45;

          atoms.forEach(atom => {
            const cx = parseFloat(atom.getAttribute("cx"));
            const cy = parseFloat(atom.getAttribute("cy"));
            const dx = cx - svgP.x;
            const dy = cy - svgP.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < minDst) {
              minDst = dist;
              closest = atom;
            }
          });

          if (closest) handleNumberingClick(closest, q);
        };
      }
      // --- Interactive Name Builder ---
      else if (q.type === "name_builder") {
        molDiv.style.display = "block";
        // Show molecule if exists
        molDiv.innerHTML = q.moleculeSVG || "";

        // Reset user selection if first load
        if (!q.userSequence) q.userSequence = [];

        const renderBuilder = () => {
          // 1. Answer Area (The sequence constructed by user) - Drop Zone
          let html = `
            <div id="nameBuilderDropZone" 
                 ondragover="handleDragOver(event)" 
                 ondragleave="handleDragLeave(event)" 
                 ondrop="handleDrop(event)"
                 style="background:rgba(0,0,0,0.2); padding:16px; border-radius:12px; margin-bottom:20px; min-height:80px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; border: 2px dashed rgba(255,255,255,0.2); transition: all 0.2s;">
              ${q.userSequence.length === 0 ? '<span class="muted" style="pointer-events:none;">Par√ßalarƒ± buraya s√ºr√ºkleyin...</span>' : ''}
              ${q.userSequence.map((token, idx) => `
                <div class="pill" onclick="handleBuilderRemove(${idx})" style="background:#7C5CFF; cursor:pointer; padding:8px 16px; border-radius:20px; user-select:none; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
                  ${token} <span style="font-size:10px; opacity:0.6; margin-left:4px;">‚úï</span>
                </div>
              `).join('')}
            </div>
          `;

          // 2. Token Pool (Available parts) - Draggable Items
          html += `
            <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
              ${q.tokens.map(token => `
                <div class="choice" draggable="true" ondragstart="handleDragStart(event, '${token}')" onclick="handleBuilderAdd('${token}')" style="width:auto; min-width:50px; padding:10px 20px; cursor:grab; user-select:none;">
                  ${token}
                </div>
              `).join('')}
            </div>
            <div class="muted small" style="text-align:center; margin-top:12px;">
              Par√ßalarƒ± yukarƒ±daki kutuya s√ºr√ºkleyip bƒ±rakƒ±n (veya tƒ±klayƒ±n).
            </div>
          `;

          choicesDiv.innerHTML = html;
          choicesDiv.className = ""; // Reset grid/tf classes

          // Enable check button if sequence is not empty
          document.getElementById("stepCheck").disabled = q.userSequence.length === 0;
        };

        // --- Global Drag & Drop Handlers ---
        window.handleDragStart = (e, token) => {
          e.dataTransfer.setData("text/plain", token);
          e.dataTransfer.effectAllowed = "copy";
          e.target.style.opacity = "0.5";
        };

        window.handleDragOver = (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = "copy";
          const zone = document.getElementById("nameBuilderDropZone");
          zone.style.borderColor = "#7C5CFF";
          zone.style.background = "rgba(124, 92, 255, 0.15)";
        };

        window.handleDragLeave = (e) => {
          const zone = document.getElementById("nameBuilderDropZone");
          zone.style.borderColor = "rgba(255,255,255,0.2)";
          zone.style.background = "rgba(0,0,0,0.2)";
          // Reset opacity of all choices (cleanup)
          document.querySelectorAll(".choice").forEach(el => el.style.opacity = "1");
        };

        window.handleDrop = (e) => {
          e.preventDefault();
          const zone = document.getElementById("nameBuilderDropZone");
          zone.style.borderColor = "rgba(255,255,255,0.2)";
          zone.style.background = "rgba(0,0,0,0.2)";

          const token = e.dataTransfer.getData("text/plain");
          if (token) {
            window.handleBuilderAdd(token);
          }
          // Reset opacity
          document.querySelectorAll(".choice").forEach(el => el.style.opacity = "1");
        };

        // Attach handler globally so onclick works
        window.handleBuilderAdd = (token) => {
          q.userSequence.push(token);
          renderBuilder();
        };

        window.handleBuilderRemove = (idx) => {
          q.userSequence.splice(idx, 1);
          renderBuilder();
        };

        renderBuilder();
      }
      // --- Standard Question ---
      else {
        topicsData.selectedAnswer = null;

        // Molecule visual
        if (q.molecule) {
          molDiv.style.display = "block";
          molDiv.innerHTML = q.molecule;
        } else {
          molDiv.style.display = "none";
          molDiv.innerHTML = "";
        }

        const hasVisual = q.choices.some(c => c.molecule || c.image);
        const isTF = q.choices.length === 2 && (q.choices[0].label === "Doƒüru" || q.choices[0].label === "Yanlƒ±≈ü");

        if (hasVisual) choicesDiv.classList.add("grid");
        if (isTF) choicesDiv.classList.add("tf");

        q.choices.forEach(c => {
          const btn = document.createElement("button");
          btn.className = "choice";
          btn.dataset.id = c.id;

          // Build content
          let content = "";
          if (c.molecule) {
            content += `<div style="margin-bottom:4px; pointer-events:none;">${c.molecule}</div>`;
          }
          if (c.image) {
            content += `<img src="${c.image}" style="width:100px; height:auto; margin-bottom:4px; pointer-events:none;">`;
          }
          content += `<div>${c.label}</div>`;

          btn.innerHTML = content;

          btn.onclick = () => {
            topicsData.selectedAnswer = c.id;
            document.querySelectorAll("#stepChoices .choice").forEach(x => x.classList.remove("selected"));
            btn.classList.add("selected");
            document.getElementById("stepCheck").disabled = false;
          };
          choicesDiv.appendChild(btn);
        });
      }

      // Reset UI controls
      document.getElementById("stepCheck").disabled = true;
      document.getElementById("stepCheck").style.display = "inline-flex";
      document.getElementById("stepNext").style.display = "none";
      document.getElementById("stepNotice").style.display = "none";

      const hintEl = document.getElementById("stepHint");
      hintEl.textContent = "";
      hintEl.style.display = "none";
      hintEl.dataset.hint = q.hint || "";
    }

    // Ordering Click Logic
    function handleOrderingClick(el, id) {
      // Simple selection for MVP: Just pick one.
      // For real ordering, we might need a list state.
      // For now, let's treat it as "Which is first?" selection.

      topicsData.selectedAnswer = id;
      document.querySelectorAll(".ordering-item").forEach(x => x.classList.remove("selected"));
      el.classList.add("selected");
      document.getElementById("stepCheck").disabled = false;
    }

    // Numbering Game Click Logic
    function handleNumberingClick(atomEl, questionData) {
      const atomId = atomEl.dataset.id;
      const currentMap = questionData.userNumbering;

      // Check if atom already has a number
      if (currentMap[atomId]) {
        const clickedNum = currentMap[atomId];
        // Cascade Delete: Delete this number AND all numbers greater than it
        Object.keys(currentMap).forEach(key => {
          if (currentMap[key] >= clickedNum) {
            delete currentMap[key];
          }
        });
      } else {
        // Assign next number
        const usedNums = Object.values(currentMap);
        const nextNum = usedNums.length > 0 ? Math.max(...usedNums) + 1 : 1;
        currentMap[atomId] = nextNum;
      }

      updateNumberingVisuals(currentMap);
    }

    function updateNumberingVisuals(map) {
      const atoms = document.querySelectorAll("#stepMolecule .atom");
      // Clear all first
      const parent = document.querySelector("#stepMolecule svg");
      // Remove existing number texts
      parent.querySelectorAll(".num-label").forEach(el => el.remove());

      // Calculate next number for badge
      const usedNums = Object.values(map);
      const nextNum = usedNums.length > 0 ? Math.max(...usedNums) + 1 : 1;
      const badge = document.querySelector("#numModeBadge span:last-child");
      if (badge) badge.textContent = `Sƒ±radaki: ${nextNum}`;

      // Draw numbers
      atoms.forEach(atom => {
        const id = atom.dataset.id;
        atom.setAttribute("fill", ""); // Reset color
        atom.style.stroke = "";
        atom.style.strokeWidth = "";

        if (map[id]) {
          const val = map[id];
          atom.setAttribute("fill", "#7C5CFF"); // Active color

          // Add text overlay
          const cx = atom.getAttribute("cx");
          const cy = atom.getAttribute("cy");

          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", cx);
          text.setAttribute("y", parseInt(cy) + 5);
          text.setAttribute("text-anchor", "middle");
          text.setAttribute("class", "num-label");
          text.setAttribute("fill", "white");
          text.setAttribute("font-weight", "bold");
          text.setAttribute("font-size", "16");
          text.style.pointerEvents = "none";
          text.textContent = val;
          parent.appendChild(text);

          document.getElementById("stepCheck").disabled = false;
        }
      });

      if (Object.keys(map).length === 0) {
        document.getElementById("stepCheck").disabled = true;
      }
    }

    // --- Check Helpers ---

    function checkChainSelection(q, isSubCheck = false) {
      const userSet = new Set(topicsData.selectedChain);
      const correctChain = q.correctChain || (q.stages && q.stages[0] ? q.stages[0].correctChain : []);
      const correctSet = new Set(correctChain);

      // Sets must be equal size and content
      let isCorrect = (userSet.size === correctSet.size && [...userSet].every(x => correctSet.has(x)));

      // Visual feedback
      const atoms = document.querySelectorAll("#stepMolecule .atom");
      atoms.forEach(atom => {
        const id = atom.dataset.id;
        atom.classList.remove("selected");

        if (correctSet.has(id)) {
          atom.classList.add("correct");
        } else if (userSet.has(id)) {
          atom.classList.add("wrong");
        }
      });

      return isCorrect;
    }

    function checkNumberingInteractive(q, isSubCheck = false) {
      // Standardize prop access (support separate obj or q itself)
      const userMap = q.userNumbering || {};
      const correctMap = q.correctNumbering || {};
      const secondaryMap = q.secondaryCorrect || null;

      const matches = (mapA, mapB) => {
        if (Object.keys(mapA).length !== Object.keys(mapB).length) return false;
        for (let k in mapA) {
          if (mapA[k] !== mapB[k]) return false;
        }
        return true;
      };

      const isCorrect = matches(userMap, correctMap) || (secondaryMap && matches(userMap, secondaryMap));

      // Visual Feedback
      const atoms = document.querySelectorAll("#stepMolecule .atom");
      atoms.forEach(atom => {
        const id = atom.dataset.id;
        atom.style.cursor = "default";

        if (userMap[id]) {
          if (isCorrect) {
            atom.setAttribute("fill", "var(--success)");
            atom.style.stroke = "rgba(56, 217, 169, 0.8)";
          } else {
            atom.setAttribute("fill", "var(--danger)");
            atom.style.stroke = "rgba(255, 107, 107, 0.8)";
          }
        }
      });
      const svg = document.querySelector("#stepMolecule svg");
      if (svg) svg.style.pointerEvents = "none";

      return isCorrect;
    }

    function checkNameBuilder(q, isSubCheck = false) {
      const userSeq = q.userSequence || [];
      const correctSeq = q.correctSequence || [];

      const isCorrect = JSON.stringify(userSeq) === JSON.stringify(correctSeq);

      // Freeze interactions
      window.handleBuilderAdd = null;
      window.handleBuilderRemove = null;

      // Visual Feedback
      const container = document.getElementById("nameBuilderDropZone");
      if (container) {
        container.style.border = isCorrect ? "2px solid var(--success)" : "2px solid var(--danger)";
        container.style.backgroundColor = isCorrect ? "rgba(56, 217, 169, 0.1)" : "rgba(255, 107, 107, 0.1)";
      }

      return isCorrect;
    }

    function checkOrderingInteractive(q) {
      const isCorrect = topicsData.selectedAnswer === q.correctOrder[0];
      const items = document.querySelectorAll(".ordering-item");
      items.forEach(item => {
        if (item.dataset.id === q.correctOrder[0]) item.classList.add("correct");
        else if (item.dataset.id === topicsData.selectedAnswer && !isCorrect) item.classList.add("wrong");
      });
      return isCorrect;
    }

    function checkStandardQuestion(q) {
      const isCorrect = topicsData.selectedAnswer === q.answerId;

      if (!isCorrect) {
        const correctBtn = document.querySelector(`.choice[data-id="${q.answerId}"]`);
        if (correctBtn) correctBtn.classList.add("ok-answer");

        if (topicsData.selectedAnswer) {
          const wrongBtn = document.querySelector(`.choice[data-id="${topicsData.selectedAnswer}"]`);
          if (wrongBtn) wrongBtn.classList.add("bad-answer");
        }
      }
      return isCorrect;
    }

    function completeStepQuestion(isCorrect) {
      const notice = document.getElementById("stepNotice");
      notice.style.display = "block";
      const hintEl = document.getElementById("stepHint");
      hintEl.textContent = hintEl.dataset.hint || "";
      hintEl.style.display = "block";

      if (isCorrect) {
        notice.className = "notice ok with-mascot";
        notice.innerHTML = getMascotHTML('happy', 'Harika i≈ü √ßƒ±kardƒ±n! üéâ +5 jeton');
        topicsData.correctCount = (topicsData.correctCount || 0) + 1;

        // Only add score once per question
        if (!topicsData.scoreAdded) {
          state.coins += 5;
          syncTop();
          topicsData.scoreAdded = true;
        }
      } else {
        notice.className = "notice bad with-mascot";
        notice.innerHTML = getMascotHTML('encouraging', 'Sorun deƒüil, tekrar dene! üôÇ');
        topicsData.wrongCount = (topicsData.wrongCount || 0) + 1;
        state.hearts = Math.max(0, state.hearts - 1);
        syncTop();
      }

      document.getElementById("stepCheck").style.display = "none";
      document.getElementById("stepNext").style.display = "inline-flex";
      // Ensure next handler is default
      const btn = document.getElementById("stepNext");
      btn.textContent = "Sonraki Soru";
      btn.onclick = nextStepQuestion;
    }

    function checkStepAnswer() {
      const q = topicsData.activeQuestions[topicsData.currentQuestionIndex];
      let isCorrect = false;

      topicsData.scoreAdded = false; // Reset score flag for this check calculation

      if (q.type === 'comprehensive') {
        // Internal stage check
        if (q.stage === 0) {
          isCorrect = checkChainSelection({ ...q, correctChain: q.stages[0].correctChain });
        } else if (q.stage === 1) {
          isCorrect = checkNumberingInteractive({ ...q, correctNumbering: q.stages[1].correctNumbering, userNumbering: q.stages[1].userNumbering });
        } else if (q.stage === 2) {
          isCorrect = checkNameBuilder({ ...q, tokens: q.stages[2].tokens, correctSequence: q.stages[2].correctSequence, userSequence: q.stages[2].userSequence });
        }

        if (isCorrect) {
          if (q.stage < 2) {
            // Intermediate Success
            const notice = document.getElementById("stepNotice");
            notice.className = "notice ok";
            notice.style.display = "block";
            notice.textContent = "Harika! Doƒüru. Sƒ±radaki a≈üamaya ge√ßiyoruz... üëá";

            // Button to trigger next phase
            const btn = document.getElementById("stepNext");
            btn.style.display = "inline-flex";
            btn.textContent = "Devam Et";
            btn.onclick = () => {
              q.stage++;
              renderStepQuestion();
            };
            // Hide Check button
            document.getElementById("stepCheck").style.display = "none";
            return; // Do not call completeStepQuestion yet
          }
        }
      }
      else if (q.type === 'chain_selection') isCorrect = checkChainSelection(q);
      else if (q.type === 'ordering_interactive') isCorrect = checkOrderingInteractive(q);
      else if (q.type === 'numbering_interactive') isCorrect = checkNumberingInteractive(q);
      else if (q.type === 'name_builder') isCorrect = checkNameBuilder(q);
      else isCorrect = checkStandardQuestion(q);

      completeStepQuestion(isCorrect);
    }

    function checkStepAnswer_OLD() {
      const q = topicsData.activeQuestions[topicsData.currentQuestionIndex];
      let isCorrect = false;

      // Logic for chain selection
      if (q.type === "chain_selection") {
        const userSet = new Set(topicsData.selectedChain);
        const correctSet = new Set(q.correctChain);

        // Sets must be equal size and content
        if (userSet.size === correctSet.size && [...userSet].every(x => correctSet.has(x))) {
          isCorrect = true;
        }

        // Visual feedback
        const atoms = document.querySelectorAll("#stepMolecule .atom");
        atoms.forEach(atom => {
          const id = atom.dataset.id;
          atom.classList.remove("selected"); // Clear selection style to apply result styles

          if (correctSet.has(id)) {
            atom.classList.add("correct"); // Always show correct chain in green
          } else if (userSet.has(id)) {
            atom.classList.add("wrong"); // Wrong selection in red
          }
        });
      }
      // Logic for Numbering Interactive
      else if (q.type === "numbering_interactive") {
        // Compare userNumbering map with correctNumbering map
        // Note: We might allow secondary correct answers (reverse numbering)

        const userMap = q.userNumbering;
        const correctMap = q.correctNumbering;
        const secondaryMap = q.secondaryCorrect;

        const userKeys = Object.keys(userMap);
        const correctKeys = Object.keys(correctMap);

        // Helper to check match
        const matches = (mapA, mapB) => {
          if (Object.keys(mapA).length !== Object.keys(mapB).length) return false;
          for (let k in mapA) {
            if (mapA[k] !== mapB[k]) return false;
          }
          return true;
        };

        if (matches(userMap, correctMap) || (secondaryMap && matches(userMap, secondaryMap))) {
          isCorrect = true;
        }

        // Visual Feedback
        const atoms = document.querySelectorAll("#stepMolecule .atom");
        atoms.forEach(atom => {
          const id = atom.dataset.id;
          // Freeze interactions
          atom.style.cursor = "default";

          if (userMap[id]) {
            if (isCorrect) {
              atom.setAttribute("fill", "var(--success)");
              atom.style.stroke = "rgba(56, 217, 169, 0.8)";
            } else {
              atom.setAttribute("fill", "var(--danger)");
              atom.style.stroke = "rgba(255, 107, 107, 0.8)";
            }
          }
        });
        document.querySelector("#stepMolecule svg").style.pointerEvents = "none";
      }
      // Logic for Name Builder
      else if (q.type === "name_builder") {
        const userSeq = q.userSequence;
        const correctSeq = q.correctSequence;

        if (JSON.stringify(userSeq) === JSON.stringify(correctSeq)) {
          isCorrect = true;
        }

        // Freeze interactions
        window.handleBuilderAdd = null;
        window.handleBuilderRemove = null;

        // Visual Feedback
        const container = document.querySelector("#stepChoices > div");
        if (container) {
          container.style.border = isCorrect ? "2px solid var(--success)" : "2px solid var(--danger)";
          container.style.backgroundColor = isCorrect ? "rgba(56, 217, 169, 0.1)" : "rgba(255, 107, 107, 0.1)";
        }
      }


      // Logic for Ordering Interactive
      else if (q.type === "ordering_interactive") {
        // Check if selected ID is the first item in correctOrder
        // MVP: We only ask "Which comes first?" so answer is correctOrder[0]
        isCorrect = topicsData.selectedAnswer === q.correctOrder[0];

        const items = document.querySelectorAll(".ordering-item");
        items.forEach(item => {
          if (item.dataset.id === q.correctOrder[0]) item.classList.add("correct");
          else if (item.dataset.id === topicsData.selectedAnswer && !isCorrect) item.classList.add("wrong");
        });
      }
      // Logic for standard question
      else {
        isCorrect = topicsData.selectedAnswer === q.answerId;

        if (!isCorrect) {
          // Highlight correct answer
          const correctBtn = document.querySelector(`.choice[data-id="${q.answerId}"]`);
          if (correctBtn) correctBtn.classList.add("ok-answer");

          // Highlight wrong selection
          if (topicsData.selectedAnswer) {
            const wrongBtn = document.querySelector(`.choice[data-id="${topicsData.selectedAnswer}"]`);
            if (wrongBtn) wrongBtn.classList.add("bad-answer");
          }
        }
      }

      const notice = document.getElementById("stepNotice");
      notice.style.display = "block";

      // Show hint after answering
      const hintEl = document.getElementById("stepHint");
      hintEl.textContent = hintEl.dataset.hint || "";
      hintEl.style.display = "block";

      if (isCorrect) {
        notice.className = "notice ok";
        notice.textContent = "Doƒüru! üéâ +5 jeton";
        state.coins += 5;
        syncTop();

        // Hide check, show next
        document.getElementById("stepCheck").style.display = "none";
        document.getElementById("stepNext").style.display = "inline-flex";
      } else {
        notice.className = "notice bad";
        notice.textContent = "Yanlƒ±≈ü üòÖ Tekrar dene!";
        state.hearts = Math.max(0, state.hearts - 1);
        syncTop();

        // Allow next even if wrong (MVP flow)
        document.getElementById("stepCheck").style.display = "none";
        document.getElementById("stepNext").style.display = "inline-flex";
      }
    }

    function nextStepQuestion() {
      const qIdx = topicsData.currentQuestionIndex;
      const questions = topicsData.activeQuestions;
      topicsData.currentQuestionIndex++;

      if (topicsData.currentQuestionIndex >= questions.length) {
        // Step completed!
        const topicId = topicsData.currentTopic;
        const topic = topicsData.topics[topicId];
        const currentStep = topicsData.currentStep;
        const progressList = topicsData.progress[topicId];

        // Find current step object for title
        const stepObj = topic.steps.find(s => s.id === currentStep);

        // Calculate accuracy
        const totalAnswered = (topicsData.correctCount || 0) + (topicsData.wrongCount || 0);
        const accuracy = totalAnswered > 0 ? (topicsData.correctCount / totalAnswered) * 100 : 0;
        const requiredAccuracy = 60;

        if (accuracy >= requiredAccuracy) {
          // Passed! Unlock next step
          if (!progressList.includes(currentStep)) {
            progressList.push(currentStep);
            state.coins += 20;
            state.progress = Math.min(100, state.progress + 5);
            syncTop();
          }

          // Show success message with mascot
          setTimeout(() => {
            if (stepObj) alert(`Tebrikler! "${stepObj.title}" adƒ±mƒ±nƒ± tamamladƒ±n! üéâ +20 jeton\n\nDoƒüruluk: %${Math.round(accuracy)}`);
          }, 100);
        } else {
          // Failed accuracy check
          setTimeout(() => {
            alert(`Adƒ±mƒ± tamamlamak i√ßin en az %${requiredAccuracy} doƒüruluk gerekiyor.\n\nSenin doƒüruluƒüun: %${Math.round(accuracy)}\n\nTekrar dene!`);
          }, 100);
        }

        // Go back to step list
        go("alkane-steps");
        renderTopicSteps();
      } else {
        renderStepQuestion();
      }
    }



    init();
  </script>


  <div id="preact-border-shadow-host" popover="manual"
    style="border: none; padding: 0px; margin: 0px; inset: 0px; position: fixed; width: 100vw; height: 100vh; background: transparent; pointer-events: none;">
  </div>
  <div id="devIndicator"
    style="position: fixed; top: 10px; right: 10px; z-index: 999; background: var(--primary); color: white; padding: 6px 12px; border-radius: 999px; font-size: 12px; font-weight: 900; cursor: pointer;">
    üîß DEV</div>
</body>

</html>